
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Desenvolupar per a Odoo &#8212; Apunts d&#39;Odoo</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'odoo';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="La vista" href="vista.html" />
    <link rel="prev" title="Instal·lar Odoo" href="instalarodoo.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/odoo_logo.svg" class="logo__image only-light" alt="Apunts d'Odoo - Home"/>
    <script>document.write(`<img src="_static/odoo_logo.svg" class="logo__image only-dark" alt="Apunts d'Odoo - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introducció a Odoo
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="instalarodoo.html">Instal·lar Odoo</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Desenvolupar per a Odoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="vista.html">La vista</a></li>
<li class="toctree-l1"><a class="reference internal" href="accions_menus.html">Accions i menús</a></li>
<li class="toctree-l1"><a class="reference internal" href="reports.html">Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="wizards.html">Wizards</a></li>
<li class="toctree-l1"><a class="reference internal" href="web_controllers.html">Web Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="client_web.html">Client Web</a></li>


<li class="toctree-l1"><a class="reference internal" href="Jupyter%20y%20Odoo.html">Usar Jupyter en Odoo.</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/xxjcaxx/exemples_sge" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/xxjcaxx/exemples_sge/issues/new?title=Issue%20on%20page%20%2Fodoo.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/odoo.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Desenvolupar per a Odoo</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arquitectura">Arquitectura</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#la-base-de-dades-d-odoo">La base de dades d’Odoo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#els-moduls">Els mòduls</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#composicio-d-un-modul">Composició d’un mòdul</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estructura-de-fitxers-d-un-modul">Estructura de fitxers d’un mòdul</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creacio-de-moduls">Creació de mòduls</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#orm">ORM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inspeccionar-el-models">Inspeccionar el models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fields">Fields</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fields-normals">Fields normals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fields-relacionals">Fields Relacionals</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reference">Reference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#many2one">Many2one</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#one2many">One2many</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#many2many">Many2many</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#related">Related</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#many2onereference">Many2oneReference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#one2one">One2one</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#filtres-domains">Filtres (Domains)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fields-computed">Fields Computed</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#buscar-i-escriure-en-camps-computed">Buscar i escriure en camps computed</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#valors-per-defecte">Valors per defecte</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#restriccions-constrains">Restriccions (constrains)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitxers-de-dades">Fitxers de dades</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#external-ids">External Ids</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expressions">Expressions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dades-per-als-binary-i-image">Dades per als Binary i Image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#esborrar">Esborrar</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accions-i-menus">Accions i menús</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accions-tipus-window">Accions tipus <em>window</em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#la-vista">La vista</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#herencia">Herència</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#herencia-en-el-model">Herència en el Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#herencia-en-la-vista">Herència en la vista</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#herencia-en-el-controlador">Herència en el controlador</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#el-controlador">El controlador</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#api-de-l-orm">API de l’ORM</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-operations">Set operations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#programacio-funcional-en-l-orm">Programació funcional en l’ORM</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#enviroment">Enviroment</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#context">Context</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodes-de-l-orm">Mètodes de l’ORM</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#search">search()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#create">create()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#write">write()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#browse">browse()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#exists">exists()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#ref">ref()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#ensure-one">ensure_one()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#unlink">unlink()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#onchange">onchange</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#cron-jobs">Cron Jobs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#els-decoradors">Els Decoradors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculs-en-dates">Càlculs en dates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#misc">Misc.</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="desenvolupar-per-a-odoo">
<h1>Desenvolupar per a Odoo<a class="headerlink" href="#desenvolupar-per-a-odoo" title="Link to this heading">#</a></h1>
<section id="arquitectura">
<h2>Arquitectura<a class="headerlink" href="#arquitectura" title="Link to this heading">#</a></h2>
<p>El <em>framework</em> d’Odoo facilita diversos components que permeten
construir l’aplicació:</p>
<ul>
<li><p>La capa <strong>ORM</strong> (Object Relational Mapping) entre els objectes
Python i la base de dades <strong>PostgreSQL</strong>. El dissenyador-programador
no efectua el disseny de la base de dades; únicament dissenya
classes, per les quals la capa ORM d’Odoo n’efectuarà el mapat sobre
el SGBD PostgreSQL</p></li>
<li><p>Una arquitectura <strong>MVC</strong>
(<a class="reference external" href="http://es.wikipedia.org/wiki/Modelo_Vista_Controlador">model-vista-controlador</a>)
en la qual el model resideix en les dades de les classes dissenyades
amb Python, la vista resideix en els formularis, llistes,
calendaris, gràfics… definits en fitxers XML i el controlador
resideix en els mètodes definits en les classes que proporcionen la
lògica de negoci.</p>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="_images/MVCDiagram.png"><img alt="Arquitectura MVC" src="_images/MVCDiagram.png" style="width: 321.0px; height: 151.0px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Arquitectura MVC</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</li>
<li><p>Odoo és un ERP amb una arquitectura <a class="reference external" href="http://es.wikipedia.org/wiki/Tenencia_M%C3%BAltiple">de Tenencia
Múltiple</a>. És A
dir, té una base de dades i un servidor comú per a tots els clients.
El contrari sería tindre un servidor o base de dades per client o
virtualitzar.</p></li>
<li><p>Dissenyadors d’informes.</p></li>
<li><p>Facilitats de traducció de l’aplicació a diversos idiomes.</p></li>
</ul>
<p>El <strong>servidor</strong> Odoo proporciona un accés a la base de dades amb
<strong>ORM</strong>. El servidor necessita tindre instal·lats <strong>mòduls</strong>, ja que
comença buit.</p>
<p>Per altra banda, el <strong>client</strong> es comunica amb el servidor en
<strong>XML-RPC</strong>, els clients web per <strong>JSON-RPC</strong>. El client sols té que mostrar el
que dona el servidor o demanar correctament les dades. Per tant, un
client pot ser molt simple i fer-se en qualsevol llenguatge de
programació. Odoo proporciona un client web encara que es pot fer un
client en qualsevol plataforma.</p>
<p>Les dades estan guardades en una <strong>base de dades relacional</strong>. Gràcies a
l’ORM, no cal fer consultes SQL directament. ORM proporciona una serie
de mètodes per a treballar de manera
més ràpida i segura. En compte de parlar de taules es parla de
<strong>models</strong>. Aquest són ‘mapejats’ per l’ORM en taules. No obstant, un
model té més que dades en una taula. Un model es comporta con un objecte
al tindre camps funcionals, restriccions i camps relacionals que deixen
la normalització de la base de dades en mans d’Odoo.</p>
<p>L’accés del client a les dades es fa fent ús d’un servici. Aquest pot
ser
<strong><a class="reference external" href="http://en.wikipedia.org/wiki/Web_Server_Gateway_Interface">WSGI</a></strong>.
WSGI és una solució estàndard per a fer servidors i clients HTTP en
Python. En el cas d’Odoo, aquest té <code class="docutils literal notranslate"><span class="pre">Werkzeug</span></code>, que interpreta les peticions i les transforma en funcions que Odoo pot entendre.</p>
<p>Un altre concepte dins d’Odoo són els <strong>Business Objects</strong>. S’implementen amb <code class="docutils literal notranslate"><span class="pre">models</span></code> i implementen tant dades com lògica de negoci.</p>
<p>Odoo proporciona els anomenats <strong>Wizards</strong>, que es comporten com un
assistent per introduir dades d’una manera més fàcil per a l’usuari.</p>
<p>El client web és fàcil de desenvolupar gràcies al <strong>Widgets</strong> o Window
GaDGETS. Aquests proporcionen un comportament i visualització correctes
per a cada tipus de dades. Per exemple: si el camp és per definir una
data, mostrarà un calendari. Alguns tenen diferents visualitzacions en
funció del tipus de vista i se’n poden definir Widgets personalitzats. Els Widgets i demés interfície web funciona gràcies a <code class="docutils literal notranslate"><span class="pre">OWL</span></code>, un framework de client web desenvolupat al projecte <code class="docutils literal notranslate"><span class="pre">Odoo</span></code> i similar a <code class="docutils literal notranslate"><span class="pre">React</span></code>.</p>
</section>
<section id="la-base-de-dades-d-odoo">
<h2>La base de dades d’Odoo<a class="headerlink" href="#la-base-de-dades-d-odoo" title="Link to this heading">#</a></h2>
<p>En l’Odoo no hi ha un disseny explícit de la base de dades, sinó que la
base de dades d’una empresa d’Odoo és el resultat del mapatge del
disseny de classes de l’ERP cap el SGBD PostgreSQL que és el que
proporciona la persistència necessària per als objectes. Això és el
<strong>ORM</strong>.</p>
<p>En conseqüència, l’Odoo no facilita cap disseny entitat-relació sobre la
base de dades d’una empresa ni tampoc cap diagrama del model relacional.</p>
<p>L’Odoo possibilita, mitjançant el clients web, recuperar el nom de la
classe Python que defineix la informació que s’introdueix a través d’un
formulari i el nom de la dada membre de la classe corresponent a cada
camp del formulari. Aquesta informació permet arribar a la taula i
columna afectades, tenint en compte dues qüestions:</p>
<ul class="simple">
<li><p>El nom de les classes Python d’Odoo sempre són en minúscula
(s’utilitza el guió baix per fer llegible els mots compostos) i
segueix la nomenclatura nom_del_modul.nom1.nom2.nom3… en la qual
s’utilitza el punt per indicar un cert nivell de jerarquia. Cada
classe Python d’Odoo és mapada en una taula de PostgreSQL amb moltes
possibilitats que el seu nom coincideixi amb el nom de la classe,
tot substituint els punts per guions baixos.</p></li>
<li><p>Els noms dels atributs d’una classe Python sempre són en minúscula
(s’utilitza el guió baix per fer llegible els mots compostos). Cada
dada membre d’una classe Python d’Odoo que siga persistent (una
classe pot tenir dades membres calculades no persistents) és mapat
com un atribut en la corresponent taula de PostgreSQL amb el mateix
nom.</p></li>
</ul>
<div class="tip admonition">
<p class="admonition-title">Exemple</p>
<p>Per exemple: La classe Python sale.order d’Odoo està pensada per descriure la capçalera de les comandes de venda i la corresponent taula a PostgreSQL és sale_order.</p>
</div>
<p>D’aquesta manera, coneixent el nom de la classe i el nom de la dada
membre, és molt possible conèixer el nom de la taula i de la columna
corresponents. Es pot configurar el client web per tal que informe del
nom de la classe i de la dada membre en situar el ratolí damunt les
etiquetes dels camps dels formularis.</p>
</section>
<section id="els-moduls">
<h2>Els mòduls<a class="headerlink" href="#els-moduls" title="Link to this heading">#</a></h2>
<p>Tant el servidor com els clients són mòduls. Tots estan guardats en una
base de dades. Tot els que es puga fer per modificar Odoo es fa en
mòduls.</p>
<section id="composicio-d-un-modul">
<h3>Composició d’un mòdul<a class="headerlink" href="#composicio-d-un-modul" title="Link to this heading">#</a></h3>
<p>Els mòduls d’Odoo amplien o modifiquen parts de
Model-Vista-Controlador. D’aquesta manera, un mòdul pot tindre:</p>
<ul class="simple">
<li><p><strong>Objectes de negoci</strong>: Són la part del model, estan definits en
classes de Python segons una sintaxi pròpia de
l’ORM d’Odoo.</p></li>
<li><p><strong>Fitxers de dades</strong>: Són fitxers XML que poden definir dades,
vistes o configuracions.</p></li>
<li><p><strong>Controladors web</strong>: Gestionen les peticions dels navegadors web.</p></li>
<li><p><strong>Dades estàtiques</strong>: Imatges, CSS, o javascript utilitzats per
l’interficie web. És necessari que les dades estatiques es guarden
en el directori <strong>static</strong>. Per exemple, l’icona del mòdul va en
static/description/icon.png</p></li>
</ul>
<section id="estructura-de-fitxers-d-un-modul">
<h4>Estructura de fitxers d’un mòdul<a class="headerlink" href="#estructura-de-fitxers-d-un-modul" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Tots el mòduls estan en un directori definit en l’opció
<strong>–addons-path</strong> o el fitxer de configuració. Poden ser més d’un
directori.</p></li>
<li><p>Un mòdul de python es declara en un fitxer de <strong>manifest</strong> que dona
informació sobre el mòdul, el que fa el mòduls dels que depen i cóm
s’ha d’instal·lar o actualitzar.
<a class="reference external" href="https://www.odoo.com/documentation/8.0/reference/module.html#reference-module-manifest">1</a></p></li>
<li><p>Un mòdul és un paquet de Python que necessita
un <strong>__init__.py</strong> per a instanciar tots els fitxers python.</p></li>
</ul>
</section>
</section>
<section id="creacio-de-moduls">
<h3>Creació de mòduls<a class="headerlink" href="#creacio-de-moduls" title="Link to this heading">#</a></h3>
<p>Per ajudar al programador, Odoo conté un comandament per crear mòduls
buits. Aquest crea l’estructura de fitxers necessaria per començar a
treballar:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> $ odoo scaffold &lt;module name&gt; &lt;where to put it&gt;
</pre></div>
</div>
<div class="dropdown admonition note">
<p class="admonition-title">Note</p>
<p>Més al voltant d’Scaffold:</p>
<p><a class="reference external" href="https://www.odoo.com/documentation/8.0/reference/cmdline.html#scaffolding">Manual oficial
Scaffolding</a></p>
<p>El parametre <strong>scaffold</strong> pot tindre la opció <strong>-t</strong> per indicar el
directori del <em>template</em>. Aquest està fet utilitzant <strong>jinja2</strong>, que és
un motor de plantilles per a python.</p>
<p>Els <em>templates</em> estan en el directori d’instal·lació d’odoo al
directori <strong>cli</strong>. En el nostre cas: <strong>cli/templates/</strong> dins del
directori d’instal·lació d’Odoo.</p>
<p>Podem fer un <em>template</em> copiant el directori default o theme i
modificant els fitxers. Això pot ser útil si sempre fem mòduls amb la
mateixa plantilla. Per exemple per ficar el nostre logo, copyright o
demés.</p>
</div>
</section>
</section>
<section id="orm">
<h2>ORM<a class="headerlink" href="#orm" title="Link to this heading">#</a></h2>
<p>Odoo mapeja els seus objectes en una base de dades amb <strong>ORM</strong>, evitant
al programador la majoria de consultes SQL. D’aquesta manera el
desenvolupament dels mòduls és molt ràpid i evitem errades de
programació.</p>
<p>Els models són creats com classes de python que extenen la classe
<strong><a class="reference external" href="https://www.odoo.com/documentation/master/developer/reference/backend/orm.html">models.Model</a></strong>
que conté els camps i mètodes útils per a fer anar l’ORM.</p>
<blockquote>
<div><p>Els models, al heretar de <strong>models.Model</strong>, necessiten donar valor a
algunes variables, com ara <strong>_name</strong></p>
</div></blockquote>
<p>Odoo considera que un model és la referència a una o més taules en la
base de dades. Un model no és una fila en la taula, és tota la taula.</p>
<blockquote>
<div><p>En programació, el ‘’’Model’’’ és una manera de relacionar el programa amb la base de dades. És de més alt nivell que les consultes directes en quant a base de dades i que les ‘’’clases i objectes’’’ respecte a la programació orientada a objectes. El model junta en un únic concepte les ‘’’estructures de dades’’’, les ‘’’restriccions d’integritat’’’ i les opcions de ‘’’manipulació’’’ de les dades.</p>
</div></blockquote>
<p>Els models en Odoo poden heretar de <strong>models.Model</strong> i ser els normals
mapejats i permanents en la base de dades. També poden ser
<strong>models.TransientModel</strong> i són iguals, sols que no tenen permanència
definitiva en la base de dades. Aquest són els recomanables per a fer
<code class="docutils literal notranslate"><span class="pre">wizards</span></code>. També poden ser <strong>models.AbstractModel</strong>
per a definir models abstractes per a després heretar.</p>
<section id="inspeccionar-el-models">
<h3>Inspeccionar el models<a class="headerlink" href="#inspeccionar-el-models" title="Link to this heading">#</a></h3>
<p>Per veure els models existents, es pot accedir a la base de dades
postgreSQL o mirar en <em>Configuración &gt; Estructura de la base de datos
&gt; Modelos</em> dins del mode desenvolupador.</p>
<p>Cal destacar el camp <em>modules</em> on diu els mòduls instal·lats on es
defineix o hereta el model observat.</p>
</section>
<section id="fields">
<h3>Fields<a class="headerlink" href="#fields" title="Link to this heading">#</a></h3>
<p>Les “columnes” del model són els fields. Aquests poden ser de dades
normals com Integer, Float, Boolean, date, char… o especials como
many2one, one2many, related…</p>
<p>Hi ha uns fields reservats:</p>
<ul class="simple">
<li><p><strong>id</strong> (Id) the unique identifier for a record in its model</p></li>
<li><p><strong>create_date</strong> (Datetime) creation date of the record</p></li>
<li><p><strong>create_uid</strong> (Many2one) user who created the record</p></li>
<li><p><strong>write_date</strong> (Datetime) last modification date of the record</p></li>
<li><p><strong>write_uid</strong> (Many2one) user who last modified the record</p></li>
</ul>
<p>Hi ha altres fields que podem declarar i tenen propietats especials.
Aquests són els més importants:</p>
<ul class="simple">
<li><p><strong>name</strong> És el field utiltizat per fer l**’Identificador Extern** o
quan es fa referència en els many2one en la vista.</p></li>
<li><p><strong>active</strong> que diu si el record és actiu. Permet ocultar productes
que ja no es necessiten, per exemple.</p></li>
<li><p><strong>sequence</strong> Permet definir l’ordre del records a mostrar en una
llista.</p></li>
</ul>
<p>Els fields es declaren amb un constructor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">LessMinimalModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test.model2&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
</pre></div>
</div>
<p>Tenen uns atributs comuns:</p>
<ul class="simple">
<li><p><strong>string</strong> (unicode, per defecte: El nom del field) L’etiqueta que
veuran els usuaris en la vista.</p></li>
<li><p><strong>required</strong> (bool, per defecte: False) Si és <em>True</em>, el camp no es
por deixar buit.</p></li>
<li><p><strong>help</strong> (unicode, per defecte: ‘’) En els formularis proporciona
ajuda a l’usuari per plenar el camp.</p></li>
<li><p><strong>index</strong> (bool, per defecte: False) Demana a Odoo fer que siga el
índex de la base de dades. En altre cas, el ORM crea un camp <strong>id</strong>.</p></li>
</ul>
<p>I algunes, sobretot les especials, tenen atributs particulars.</p>
<p>Exemple complet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;a_name&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span>
        <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Name&quot;</span><span class="p">,</span>                   <span class="c1"># Optional label of the field</span>
        <span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_compute_name_custom&quot;</span><span class="p">,</span>  <span class="c1"># Transform the fields in computed fields</span>
        <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                      <span class="c1"># If computed it will store the result</span>
        <span class="n">select</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                     <span class="c1"># Force index on field</span>
        <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                   <span class="c1"># Field will be readonly in views</span>
        <span class="n">inverse</span><span class="o">=</span><span class="s2">&quot;_write_name&quot;</span>            <span class="c1"># On update trigger</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                   <span class="c1"># Mandatory field</span>
        <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                  <span class="c1"># Translation enable</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;blabla&#39;</span><span class="p">,</span>                   <span class="c1"># Help tooltip text</span>
        <span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>          <span class="c1"># Transform columns to ir.property</span>
        <span class="n">search</span><span class="o">=</span><span class="s1">&#39;_search_function&#39;</span><span class="p">,</span>        <span class="c1"># Custom search function mainly used with compute</span>
        <span class="n">copy</span> <span class="o">=</span><span class="kc">True</span>                       <span class="c1"># Si es pot copiar amb el mètode copy() </span>
    <span class="p">)</span>

   <span class="c1"># The string key is not mandatory</span>
   <span class="c1"># by default it wil use the property name Capitalized</span>

   <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>  <span class="c1">#  Valid definition</span>
</pre></div>
</div>
<p>Si volem <strong>valors per defecte</strong>, es poden indicar com un atribut del
field.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;Alberto&#39;</span><span class="p">)</span>
 <span class="c1"># o:</span>
 <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">a_fun</span><span class="p">)</span>
 <span class="c1">#...</span>
 <span class="k">def</span> <span class="nf">a_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_something</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="fields-normals">
<h3>Fields normals<a class="headerlink" href="#fields-normals" title="Link to this heading">#</a></h3>
<p>Aquests són els fields per a dades normals que proporciona Odoo:</p>
<ul class="simple">
<li><p>Integer</p></li>
<li><p>Char</p></li>
<li><p>Text</p></li>
<li><p>Date : Mostra un calendari en la vista.</p></li>
<li><p>Datetime</p></li>
<li><p>Float</p></li>
<li><p>Boolean</p></li>
<li><p>Html : Guarda un text, però es representa de manera especial en el
client.</p></li>
<li><p>Binary : Per guardar, per exemple, imatges. Utilitza codificació
base64 al enviar els fitxers al client. En realitat les guarda en
<strong>/var/lib/odoo/.local/share/Odoo/filestore</strong> i la ruta als fitxers
la diu la taula <strong>ir_attachment</strong> junt amb el id, nom del field i el
model.</p></li>
<li><p>Image (Odoo13) : En el cas d’imatges, accepta els atributs
<strong>max_width</strong> i <strong>max_height</strong> on es pot dir en píxel que ha de
redimensionar la imatge a eixa mida màxima.</p></li>
<li><p>Selection : Mostra un select amb les opcions indicades.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>     <span class="nb">type</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;Basic&#39;</span><span class="p">),(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;Intermediate&#39;</span><span class="p">),(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;Completed&#39;</span><span class="p">)])</span>
     <span class="n">aselection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s1">&#39;a_function_name&#39;</span><span class="p">)</span> <span class="c1"># Es pot cridar a una funció que defineix les opcions.</span>
</pre></div>
</div>
</section>
<section id="fields-relacionals">
<h3>Fields Relacionals<a class="headerlink" href="#fields-relacionals" title="Link to this heading">#</a></h3>
<p>Les relacions entre els models (en definitiva, entre les taules de la
base de dades) també les simplifica l’ORM. D’aquesta maneram les
relacions 1 a molts es fan en el Odoo anomena Many2one i les relacions
Mols a Molts es fan el el Many2Many. Les relacions molts a molts, en una
base de dades relacional, impliquen una tercera taula en mitg, però en
Odoo no tenim que preocupar-nos d’aquestes coses si no volem, el mapat
dels objectes el detectarà i farà les taules, claus i restriccions
d’integritat necessaries. Anem a repasar un a un aquests camps:</p>
<section id="reference">
<h4>Reference<a class="headerlink" href="#reference" title="Link to this heading">#</a></h4>
<p>Una referència arbitrària a un model i un camp.
<a class="reference external" href="http://www.zbeanztech.com/blog/reference-fields-odoo">2</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> 
 <span class="n">aref</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Reference</span><span class="p">([(</span><span class="s1">&#39;model_name&#39;</span><span class="p">,</span> <span class="s1">&#39;String&#39;</span><span class="p">)])</span>
 <span class="n">aref</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;model_name&#39;</span><span class="p">,</span> <span class="s1">&#39;String&#39;</span><span class="p">)])</span>
 <span class="n">aref</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">selection</span><span class="o">=</span><span class="s1">&#39;a_function_name&#39;</span><span class="p">)</span>

<span class="c1"># Fragment de test_new_api:</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Related Document&#39;</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;_reference_models&#39;</span><span class="p">)</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
    <span class="k">def</span> <span class="nf">_reference_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">)])</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ir.&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Els fields reference no són molt utilitzats, ja que normalment les
relacions entre models són sempre les mateixes.</p>
</section>
<section id="many2one">
<h4>Many2one<a class="headerlink" href="#many2one" title="Link to this heading">#</a></h4>
<p>Relació amb un altre model</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">arel_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">)</span>
 <span class="n">arel_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;res.users&#39;</span><span class="p">)</span>
 <span class="n">an_other_rel_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">delegate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>En aquest cas:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>----------            -----------
| Pais   |  one       |  Ciutat | 
---------- -----      -----------
| * id   |     |      | * id    |
| * name |     |  many| * name  |
----------     |------| * pais  |
                      -----------
</pre></div>
</div>
<p>El codi resultant sería:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ciutat</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;mon.ciutat&#39;</span>
    <span class="n">pais</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s2">&quot;mon.pais&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Pais&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;restrict&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>delegate</strong> està en True per a fer que els fields del model apuntat
siguen accessibles des del model actual.</p>
<p>Accepta també <strong>context</strong> i <strong>domain</strong> com en la vista. D’aquesta
manera queda disponible per a totes les possibles vistes.</p>
<p>Un altre argument addicional és <strong>ondelete</strong> que permet definir el
comportament al esborrar l’element referenciat a <strong>set null</strong>,
<strong>restrict</strong> o <strong>cascade</strong>.</p>
<blockquote>
<div><p>ondelete cascade esborra els fills a nivel de PostgreSQL, però no elimina en External Id, això es fa en unlink(), però no executa unlink() dels fills. Per tant, si volem que s’eliminen per complet, cal heretar el unlink del pare i afegir la cridada al dels fills.</p>
</div></blockquote>
</section>
<section id="one2many">
<h4>One2many<a class="headerlink" href="#one2many" title="Link to this heading">#</a></h4>
<p>Inversa del Many2one. Necessita de la existència d’un Many2one en
l’altre:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">arel_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="s1">&#39;arel_id&#39;</span><span class="p">)</span>
 <span class="n">arel_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="n">inverse_name</span><span class="o">=</span><span class="s1">&#39;arel_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Un One2many funciona perquè hi ha un many2one en l’altre model.
D’aquesta manera, sempre has de especificar el nom del model i el nom
del camp Many2one del model que fa referencia a l’actual, com es pot
veure en l’exemple.</p>
<p>En l’exemple anterior, quedaria com:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">pais</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;mon.pais&#39;</span>
    <span class="n">ciutats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;mon.ciutat&#39;</span><span class="p">,</span> <span class="s1">&#39;pais&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Ciutats&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="danger admonition">
<p class="admonition-title">Important</p>
<p>És important entendre que el One2many no implica dades addicionals en la base de dades i sempre és calculat com un ‘’select’’ en la base de dades on el id del model actual coincidisca amb el Many2one (clau aliena) de l’altre model. Això fa que no tinga sentit fer One2many computed o ficar un domain per restringit els que es poden afegir.</p>
</div>
<div class="tip admonition">
<p class="admonition-title">Domains</p>
<p>Els One2many poden tindre domain per no mostrar els que no compleixen una condició, això no significa que no existeixi aquesta relació.</p>
</div>
</section>
<section id="many2many">
<h4>Many2many<a class="headerlink" href="#many2many" title="Link to this heading">#</a></h4>
<p>Relació molts a molts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">arel_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">)</span>
 <span class="n">arel_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="c1"># El model en el que es relaciona</span>
                            <span class="n">relation</span><span class="o">=</span><span class="s1">&#39;table_name&#39;</span><span class="p">,</span> <span class="c1"># (opcional) el nom del la taula en mig</span>
                            <span class="n">column1</span><span class="o">=</span><span class="s1">&#39;col_name&#39;</span><span class="p">,</span> <span class="c1"># (opcional) el nom en la taula en mig de la columna d&#39;aquest model</span>
                            <span class="n">column2</span><span class="o">=</span><span class="s1">&#39;other_col_name&#39;</span><span class="p">)</span>  <span class="c1"># (opcional) el nom de la columna de l&#39;altre model.</span>
</pre></div>
</div>
<p>El primer exemple sol funcionar directament, però si volem tindre més
d’una relació Many2many entre els dos mateixos models, cal utilitzar la
sintaxi completa on especifiquem el nom de la relació i el nom de les
columnes que identifiquem els dos models. Pensem que una relació
Many2many implica una taula en mig i estem especificant les seues claus
alienes.</p>
</section>
<section id="related">
<h4>Related<a class="headerlink" href="#related" title="Link to this heading">#</a></h4>
<p>Un camp d’un altre model, necessita una relació Many2one. D’aquesta
manera es poden aprofitar les funcionalitats de guardar, com ara les
búsquedes o referències en funcions. En termes de bases de dades, un
camp related trenca la tercera forma normal. Això sol ser problemàtic,
però Odoo té mecanismes per a que no passe res. De totes maneres, si ens
preocupa això, amb store=False no guarda res en la taula.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">participant_nick</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Nick name&#39;</span><span class="p">,</span>
                               <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">related</span><span class="o">=</span><span class="s1">&#39;partner_id.name&#39;</span>
</pre></div>
</div>
<p>Un camp related pot ser de qualsevol tipus. Per exemple, many2one:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sala</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;cine.sala&#39;</span><span class="p">,</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;sessio.sala&#39;</span><span class="p">,</span><span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="many2onereference">
<h4>Many2oneReference<a class="headerlink" href="#many2onereference" title="Link to this heading">#</a></h4>
<p>Un Many2one on es guardar també el model al qual fa referència amb l’atribut: <strong>model_field</strong>.</p>
</section>
<section id="one2one">
<h4>One2one<a class="headerlink" href="#one2one" title="Link to this heading">#</a></h4>
<p>Els camps <strong>One2one</strong> no existeixen en Odoo. Però si volem aquesta
funcionalitat podem utilitzar varies tècniques:</p>
<ul class="simple">
<li><p>Fer dos camps Many2many i restringir amb constrains que sols pot
existir una relació. Problemes:</p>
<ul>
<li><p>En la vista no podem ficar un widget com en el Many2one i és
complicat evitar relacions creuades.</p></li>
<li><p>Es pot fer un <strong>limit</strong> en la vista, però es continuarà
comportant com un Many2many.</p></li>
</ul>
</li>
<li><p>Fer dos Many2one i restringit amb contrains o sql constrains que
sols pot existir una relació mútua. (Cal sobreescriure els mètodes
create i write per a que es cree l’associació automàticament).
Problemes:</p>
<ul>
<li><p>Si sobreescribim el write de els dos, es pot produir una cridada
recursiva sense fi i és molt complicat aconseguir que no tingam
referències creuades.</p></li>
</ul>
</li>
<li><p>Fer un Many2one i en l’altre model un Many2one computed que busque
en els del primer model. Per poder editar en els dos cal fer una
funció inversa per al camp computed. Aquesta és una de les opcions
més elegants. Exemple:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">orderline</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;sale.order.line&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;sale.order.line&#39;</span>
    <span class="n">booking</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;reserves.bookings&#39;</span><span class="p">)</span>
      
    <span class="n">_sql_constraints</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;booking_uniq&#39;</span><span class="p">,</span> <span class="s1">&#39;unique(booking)&#39;</span><span class="p">,</span> <span class="s1">&#39;There is another order line for this booking&#39;</span><span class="p">),</span>
    <span class="p">]</span>

<span class="k">class</span> <span class="nc">bookings</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;reserves.bookings&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">order_line</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;sale.order.line&#39;</span><span class="p">,</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_get_order_line&#39;</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_set_order_line&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">multi</span>
    <span class="k">def</span> <span class="nf">_get_order_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">b</span><span class="o">.</span><span class="n">order_line</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;sale.order.line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;booking.id&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span><span class="o">.</span><span class="n">id</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">one</span>
    <span class="k">def</span> <span class="nf">_set_order_line</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_line</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;sale.order.line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">o</span><span class="p">)])</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;booking&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Fer un Many2one i un One2many i restringir el màxim del One2many (
<a class="reference external" href="https://stackoverflow.com/questions/32801526/how-to-create-a-one2one-relationship-in-odoo-8">3</a>
). Problemes:</p>
<ul>
<li><p>Els mateixos que en els dos many2manys. És més simple restringir
les relacions creuades.</p></li>
</ul>
</li>
<li><p>Fer una herència múltiple.
<a class="reference external" href="http://blog.odoobiz.com/2014/10/openerp-one2one-relational-field-example.html">4</a>.
Problemes:</p>
<ul>
<li><p>Esta és, en teoría, la forma més oficial de fer-ho, però obliga
a crear sempre la relació i els models en un ordre determinat.</p></li>
</ul>
</li>
</ul>
</section>
<section id="filtres-domains">
<h4>Filtres (Domains)<a class="headerlink" href="#filtres-domains" title="Link to this heading">#</a></h4>
<p>En ocasions és necessari afegir un filtre en el codi python per fer que
un camp <strong>relacional</strong> no puga tindre certes referències. El
comportament del domain és diferent depen del tipus de field.</p>
<ul class="simple">
<li><p><strong>Domain en Many2one</strong>: Filtra els elements del model referenciat
que poden ser elegits per al field:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parent</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;game.resource&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;[(&#39;template&#39;, &#39;=&#39;, True)]&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Domain en Many2many</strong>: La llista d’elements a triar es filtra
segons el domain:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">allowed_value_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span>
    <span class="n">comodel_name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_compute_allowed_value_ids&quot;</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">_compute_allowed_value_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">record</span><span class="o">.</span><span class="n">allowed_value_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">value_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span>
    <span class="n">comodel_name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;[(&#39;id&#39;, &#39;in&#39;, allowed_value_ids)]&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Domain en One2many</strong>: Al ser una relació que depen d’altre
Many2one, no es pot filtrar, si fiquem un domain, sols deixarà de
mostrar els que no compleixen el domain, però no deien d’existir:</p></li>
</ul>
</section>
</section>
<section id="fields-computed">
<h3>Fields Computed<a class="headerlink" href="#fields-computed" title="Link to this heading">#</a></h3>
<p>Moltes vegades volem que el contingut d’un camp siga calculat en el
moment en que anem a veure-lo. Tots els tipus de fields poden ser
computed. Anem a veure alguns exemples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>   <span class="n">taken_seats</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Taken seats&quot;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_taken_seats&#39;</span><span class="p">)</span>   <span class="c1"># Aquest camp no es guarda a la base de dades </span>
                                                                <span class="c1">#i sempre es recalcula quan executem un action que el mostra</span>

   <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;seats&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>  <span class="c1"># El decorador @api.depends() indica que es cridarà a la funció </span>
                                          <span class="c1"># sempre que es modifiquen els camps seats i attendee_ids. </span>
                                          <span class="c1">#Si no el posem, es recalcula sols al recarregar el action.</span>
   <span class="k">def</span> <span class="nf">_taken_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>          
      <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>  <span class="c1"># El for recorre self, que és un recordset amb tots els elements del model mostrats </span>
                      <span class="c1"># per la vista, si és un tree, seran tots els visibles i si és un form, serà un singleton.</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">seats</span><span class="p">:</span> <span class="c1"># r és un singleton i es pot accedir als fields com a variables de l&#39;objecte.      </span>
              <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">0.0</span> 
          <span class="k">else</span><span class="p">:</span>
              <span class="n">r</span><span class="o">.</span><span class="n">taken_seats</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span><span class="o">.</span><span class="n">seats</span>
</pre></div>
</div>
<p>En aquest exemple es veu cóm el camp <em>float</em> taken seats es calcula en
una funció privada _taken_seats. És interessant observar el <em>for</em>
perquè recorre totes les instancies a les que fa referència el model.
Aquesta funció sols s’executarà una vegada encara que tinga que
calcular tots els elements d’una llista. Per això, la propia funció és
la que té que iterar els elements de <strong>self</strong>. <strong>self</strong> és un
<code class="docutils literal notranslate"><span class="pre">recordset</span></code>, per tant, és com una llista
en la que cada element és un registre del model. Si el computed és
cridat al entrar a un formulari, el recordset tindrà sols un element,
però si el camp computed es veu en una llista (tree), pot ser que siguen
més d’un registre. És important recordar fer el <strong>for record in self:</strong>
encara que pensem que el camp computed sols l’utilitzarem en un
formulari.</p>
<p>Exemples de <strong>computed</strong> de tots els tipus de fields:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span><span class="p">,</span> <span class="n">tools</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">proves_computed</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
     <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;proves_computed.proves_computed&#39;</span>

     <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
     <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
     <span class="n">image</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">String</span><span class="o">=</span><span class="s2">&quot;Image original&quot;</span><span class="p">)</span>
     <span class="n">computedfloat</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
     <span class="n">computedchar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
     <span class="n">medium_image</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_redimensionar&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
     <span class="n">small_image</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_redimensionar&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
     <span class="n">computedm2o</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
     <span class="n">computedm2m</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;product.template&#39;</span><span class="p">,</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
     <span class="n">computeddate</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
     <span class="n">computeddatetime</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_value_pc&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
     
     <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">()</span>

     <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
     <span class="k">def</span> <span class="nf">_value_pc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="n">r</span><span class="o">.</span><span class="n">computedfloat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span> 
        <span class="n">r</span><span class="o">.</span><span class="n">computedchar</span> <span class="o">=</span> <span class="s2">&quot;(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>
        <span class="n">r</span><span class="o">.</span><span class="n">computedm2o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span><span class="o">.</span><span class="n">id</span> <span class="c1"># Many2one espera un id, que és un camp Integer. </span>
        <span class="nb">print</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[93m&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;product.product&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0m&#39;</span>
        <span class="n">r</span><span class="o">.</span><span class="n">computedm2m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;product.template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span><span class="o">.</span><span class="n">ids</span> <span class="c1">#Many2many espera un array d&#39;ids o un recordset. </span>
        <span class="c1"># El codi comentat a continuació fa el mateix, per si volem fer altres coses dins del for.</span>
        <span class="c1">#ids = []</span>
        <span class="c1">#for t in self.env[&#39;product.template&#39;].search([(&#39;id&#39;,&#39;&gt;&#39;,r.value)]):</span>
        <span class="c1"># ids.append(t.id)</span>
        <span class="c1">#r.computedm2m = ids</span>
 
        <span class="c1">#r.computeddate = date.today() # Aquest depen de Python</span>
        <span class="n">r</span><span class="o">.</span><span class="n">computeddate</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="c1"># Recomanem aquest, ja que és propi de la classe fields d&#39;Odoo</span>
        <span class="c1">#r.computeddate = datetime.now()</span>
        <span class="n">r</span><span class="o">.</span><span class="n">computeddatetime</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        

     <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;image&#39;</span><span class="p">)</span>
     <span class="k">def</span> <span class="nf">_redimensionar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
         <span class="n">image_original</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">image</span>
         <span class="k">if</span> <span class="n">image_original</span><span class="p">:</span>
            <span class="n">images</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_get_resized_images</span><span class="p">(</span><span class="n">image_original</span><span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">medium_image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;image_medium&#39;</span><span class="p">]</span>                        
            <span class="n">r</span><span class="o">.</span><span class="n">small_image</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="s1">&#39;image_small&#39;</span><span class="p">]</span>                
         <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">medium_image</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>                        
            <span class="n">r</span><span class="o">.</span><span class="n">small_image</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>(<a class="reference external" href="https://github.com/xxjcaxx/SGE-Odoo-2016-2017/tree/master/proves_computed">Codi
complet</a>)</p>
<blockquote>
<div><p>En l’apartat del <code class="docutils literal notranslate"><span class="pre">controlador</span></code> s’expliquem més detalls de les funcions en python-odoo.</p>
</div></blockquote>
<section id="buscar-i-escriure-en-camps-computed">
<h4>Buscar i escriure en camps computed<a class="headerlink" href="#buscar-i-escriure-en-camps-computed" title="Link to this heading">#</a></h4>
<p>Amb el <strong>api.depends</strong> podem fer que camps calculats puguen ser buscats
o referenciats des d’uns altres models, ja que podem dir que sí se
guarden en la base de dades. Si es guarda en la base de dades no es
recalcula fins que no canvia el contingut del <em>field</em> del que depèn.
Però si el camp calculat no depèn de valors estàtics d’altres <em>fields</em>
i/o necessitem que sempre es calcule, no tenim moltes opcions elegants.
Una d’elles pot ser fer dos camps, un calculat <strong>store=False</strong> i altre
no i fer un <em>write</em> en la funció. L’altra possibilitat és fer una
funció pública que puga ser cridada des d’un altre model. La més
elegant que no sempre funciona és utilitzar l’opció <strong>search</strong> i
assignar-li una funció que ha de retornar un domini de búsqueda. El
problema és que no accepta molta complexitat, ja que suposa una cerca
per tota la base de dades i pot ser molt ineficient.</p>
<p>Per defecte no es pot escriure en un camp <em>computed</em>. No té massa sentit
la majoria dels casos, ja que és un camp que depèn d’altres. Però pot
ser que, de vegades volem escriure el resultat i que modifique el camp
origen. Imaginem, per exemple, que sabem el preu final i volem que
calcule el preu sense IVA. Per fer-ho, la millor manera és crear una
funció i fer que estiga en l’opció <strong>inverse</strong>.</p>
<p>Exemple:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">preu</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="s1">&#39;Price&#39;</span><span class="p">,</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_get_price&quot;</span><span class="p">,</span><span class="n">search</span><span class="o">=</span><span class="s1">&#39;_search_price&#39;</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_set_price&#39;</span><span class="p">)</span>

 <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;pelicula&#39;</span><span class="p">,</span><span class="s1">&#39;descompte&#39;</span><span class="p">)</span>
      <span class="k">def</span> <span class="nf">_get_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
          <span class="n">price</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">pelicula</span><span class="o">.</span><span class="n">preu</span>
          <span class="n">price</span> <span class="o">=</span> <span class="n">price</span> <span class="o">-</span> <span class="p">(</span><span class="n">price</span><span class="o">*</span><span class="n">r</span><span class="o">.</span><span class="n">descompte</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
          <span class="n">r</span><span class="o">.</span><span class="n">preu</span> <span class="o">=</span> <span class="n">price</span>

      <span class="k">def</span> <span class="nf">_search_price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">operator</span><span class="p">,</span><span class="n">value</span><span class="p">):</span> <span class="c1"># De moment aquest search sols és per a ==</span>
       <span class="n">preus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">id</span> <span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">pelicula</span><span class="o">.</span><span class="n">preu</span> <span class="o">-</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">pelicula</span><span class="o">.</span><span class="n">preu</span><span class="o">*</span><span class="n">e</span><span class="o">.</span><span class="n">descompte</span><span class="o">/</span><span class="mi">100</span><span class="p">)])</span> <span class="c1"># Un bon exemple de mapped en lambda</span>
       <span class="nb">print</span> <span class="n">preus</span>
       <span class="n">p</span> <span class="o">=</span> <span class="p">[</span> <span class="n">num</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">preus</span> <span class="k">if</span> <span class="n">num</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">]</span>  <span class="c1"># condició if en una llista python sense fer un for (list comprehension)</span>
       <span class="c1"># també es pot provar en un filter() de python</span>
       <span class="nb">print</span> <span class="n">p</span>
       <span class="c1"># p és una llista de les id que ja compleixen la condició, per tant sols cal fer que la id estiga en la llista.</span>
       <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;in&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">)]</span>

      <span class="k">def</span> <span class="nf">_set_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">pelicula</span><span class="o">.</span><span class="n">preu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preu</span>  <span class="c1"># Açò és un exemple, però està mal, ja que modifiques el preu de la peli en totes les sessions</span>
</pre></div>
</div>
<p>Documentació oficial: <a class="reference external" href="https://www.odoo.com/documentation/master/developer/reference/backend/orm.html">https://www.odoo.com/documentation/master/developer/reference/backend/orm.html</a></p>
</section>
</section>
<section id="valors-per-defecte">
<h3>Valors per defecte<a class="headerlink" href="#valors-per-defecte" title="Link to this heading">#</a></h3>
<p>En Odoo és molt fàcil fer valors per defecte, ja que és un argument més
en el constructor dels fields:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;Unknown&quot;</span><span class="p">)</span>
<span class="n">user_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
<span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">compute_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">()</span>
<span class="n">a_field</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">compute_default_value</span><span class="p">)</span>
</pre></div>
</div>
<p>Si volem, per exemple, ficar la data del moment de crear, no podem fer
això:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>  <span class="c1"># MAL</span>
</pre></div>
</div>
<p>Perquè calcula la data del moment d’actualitzar el mòdul, no el de
crear l’element en el model. Cal fer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>  <span class="c1"># CORRECTE</span>
</pre></div>
</div>
<p>o</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span> <span class="c1"># CORRECTE</span>
</pre></div>
</div>
<p>El valor per defecte no pot dependre d’un field que està creant-se en
eixe moment. En eixe cas es pot utilitzar un <strong>on_change</strong>.</p>
<p>En cas de tindre molts valors per defecte o que depenen del context, es
pot utilitzar la funció <strong>default_get</strong> que ja tenen els models.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
    <span class="k">def</span> <span class="nf">default_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_fields</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SelectSalePrice</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">default_get</span><span class="p">(</span><span class="n">default_fields</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default_picking_id&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;picking_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;default_picking_id&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>El que fa aquesta funció és un poc avançat de moment, ja que fa ús del <code class="docutils literal notranslate"><span class="pre">context</span></code> i l’herencia per afegir un valor per
defecte al diccionari que retorna aquesta funció en la classe <em>Model</em></p>
</section>
<section id="restriccions-constrains">
<h3>Restriccions (constrains)<a class="headerlink" href="#restriccions-constrains" title="Link to this heading">#</a></h3>
<p>Els objectes poden incorporar, de forma opcional, restriccions
d’integritat, addicionals a les de la base de dades. Odoo valida
aquestes restriccions en les modificacions de dades i, en cas de
violació, mostra una pantalla d’error.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo.exceptions</span> <span class="kn">import</span> <span class="n">ValidationError</span>

<span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_check_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;Your record is too old: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">record</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
    <span class="c1"># all records passed the test, don&#39;t return anything</span>
</pre></div>
</div>
<p>En ocasions, quan tenim clar cóm faríem aquesta restricció en SQL, tal
vegada ens resulte més interessant fer una restricció de la base de
dades amb una <strong>sql constraint</strong>. Aquestes es defineixen amb 3 strings
<strong>(name, sql_definition, message)</strong>. Per exemple:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_sql_constraints</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;name_uniq&#39;</span><span class="p">,</span> <span class="s1">&#39;unique(name)&#39;</span><span class="p">,</span> <span class="s1">&#39;Custom Warning Message&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;contact_uniq&#39;</span><span class="p">,</span> <span class="s1">&#39;unique(contact)&#39;</span><span class="p">,</span> <span class="s1">&#39;Custom Warning Message&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>En aquest cas és una restricció d’unicitat, la qual és més simple que
fer una búsqueda en python.</p>
</section>
</section>
<section id="fitxers-de-dades">
<h2>Fitxers de dades<a class="headerlink" href="#fitxers-de-dades" title="Link to this heading">#</a></h2>
<p>Quan fem un mòdul d’Odoo, es poden definir dades que es guardaran en la
base de dades. Aquestes dades poden ser necessàries per al funcionament
del mòdul, de demostració o inclús part de la vista.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Alguns mòduls sols estan per clavar dades en Odoo</p>
</div>
<p>Tots els fitxers de dades són en XML i tenen una estructura com esta:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;odoo&gt;</span>
<span class="w">        </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;{model name}&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;{record identifier}&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;{a field name}&quot;</span><span class="nt">&gt;</span>{a<span class="w"> </span>value}<span class="nt">&lt;/field&gt;</span>
<span class="w">        </span><span class="nt">&lt;/record&gt;</span>
<span class="nt">&lt;odoo&gt;</span>
</pre></div>
</div>
<p>Dins de les etiquetes <strong>odoo</strong> poden trobar una etiqueta <strong>record</strong> per cada
fila en la taula que volem introduir. Cal especificar el model i el id.
El <strong>id</strong> és un identificador extern, que no te perquè coincidir amb la
clau primària que l’ORM utilitzarà després. Cada <strong>field</strong> tindrà un
nom i un valor.</p>
<section id="external-ids">
<h3>External Ids<a class="headerlink" href="#external-ids" title="Link to this heading">#</a></h3>
<p>Tots els records de la base de dades tenen un identificador únic en la
seua taula, el <strong>id</strong>. És un número auto incremental assignat per la
base de dades. No obstant, si volem fer referència a ell en fitxers de
dades o altres llocs, no sempre tenim perquè saber el id. La solució
d’odoo són els <strong>External Identifiers</strong>. Això és una taula que
relaciona cada id de cada taula en un nom. Es tracta del model
<strong>ir.model.data</strong>. Per trobar-los cal anar a:</p>
<p><code class="docutils literal notranslate"><span class="pre">Settings &gt; Technical &gt; Sequences &amp; identifiers &gt; External Indentifiers</span></code></p>
<p>Ahí dins trobem la columna <strong>Complete ID</strong>.</p>
<p>Per trobar les <em>id</em> al fer fitxers de demostració o de dades podem anar
al menú, però eixes ids canvien d’una instal·lació a un altra. Per
tant, cal utilitzar les <strong>external id</strong>. Per aconseguir-lo podem obrir
el mode desenvolupador i obrir el menú <strong>View Metadata</strong>.</p>
<p>En les dades de demo, els <strong>external Ids</strong> s’utilitzen per no utilitzar
les id, que poden canviar al ser auto incrementals. Per a que funcione
cal utilitzar l’atribut <strong>ref</strong>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;product_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;product.product1&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Es recomana fer l’atribut ‘’’id’’’ en el record, encara que no sobreescriu el id real, serveix per declarar el External Id i és més fàcil després fer referència a ell.</p>
</div>
<blockquote>
<div><p>Veure també la funció <strong>ref()</strong> de l’ORM</p>
</div></blockquote>
</section>
<section id="expressions">
<h3>Expressions<a class="headerlink" href="#expressions" title="Link to this heading">#</a></h3>
<p>De vegades volem que els fields es calculen cada vegada que
s’actualitza el mòdul. Això es pot fer en l’atribut <strong>eval</strong> que
avalua una expressió de Python.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;date&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;(datetime.now()+timedelta(-1)).strftime(&#39;%Y-%m-%d&#39;)&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;product_id&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;ref(&#39;product.product1&#39;)&quot;</span><span class="nt">/&gt;</span><span class="w"> </span>#<span class="w"> </span>Equivalent<span class="w"> </span>a<span class="w"> </span>l&#39;exemple<span class="w"> </span>anterior
<span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;price&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;ref(&#39;product.product1&#39;).price&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;avatar&quot;</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;school.template&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;obj().env.ref(&#39;school.template_student1&#39;).image&quot;</span><span class="w"> </span><span class="nt">&gt;&lt;/field&gt;</span><span class="w">  </span>#<span class="w"> </span>Com<span class="w"> </span>que<span class="w"> </span>utilitza<span class="w"> </span>obj()<span class="w"> </span>necessita<span class="w"> </span>model=&quot;...
</pre></div>
</div>
<p>Per al x2many, es pot utilitzar el eval per assignar una llista
d’elements.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tag_ids&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;[(6,0,[ref(&#39;vehicle_tag_leasing&#39;),ref(&#39;fleet.vehicle_tag_compact&#39;),</span>
<span class="s">                                   ref(&#39;fleet.vehicle_tag_senior&#39;)] )]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Observem que hem passat una tripleta amb un 6, un 0 i una llista de
refs. Les tripletes poden ser:</p>
<ul class="simple">
<li><p>(0,_ ,{‘field’: value}): Crea un nou registre i el vincula</p></li>
<li><p>(1,id,{‘field’: value}): Actualtiza els valors en un registre ja
vinculats</p></li>
<li><p>(2,id,_): Desvincula i elimina el registre</p></li>
<li><p>(3,id,_): Desvincula però no elimina el registre de la relació.</p></li>
<li><p>(4,id,_): Vincula un registre ja existent</p></li>
<li><p>(5,_,_): Desvincula pero no elimina tots els registres vinculats</p></li>
<li><p>(6,_,[ids]): Reemplaça la llista de registres vinculats.</p></li>
</ul>
</section>
<section id="dades-per-als-binary-i-image">
<h3>Dades per als Binary i Image<a class="headerlink" href="#dades-per-als-binary-i-image" title="Link to this heading">#</a></h3>
<p>Algunes dades com les imatges o fitxers es poden posar en records. Hi ha dos maneres:</p>
<ul class="simple">
<li><p>Convertir en Base64 el fitxer i copiar i pegar el resultat dins del field.</p></li>
<li><p>Afegir el atribut <code class="docutils literal notranslate"><span class="pre">type=&quot;base64&quot;</span></code> i el atribut <code class="docutils literal notranslate"><span class="pre">file=&quot;modul/demo/fitxer&quot;</span></code></p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;image_1920&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;base64&quot;</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;exemple/demo/cares/1000.jpg&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Observem la ruta que inicia des del directori del mòdul.</p>
</section>
<section id="esborrar">
<h3>Esborrar<a class="headerlink" href="#esborrar" title="Link to this heading">#</a></h3>
<p>Amb l’etiqueta <strong>delete</strong> es pot especificar els elements a esborrar
amb el external ID o amb un search:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;delete</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;cine.sessio&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;sessio_cine1_1&quot;</span><span class="nt">&gt;&lt;/delete&gt;</span>
</pre></div>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Si falla l’actualització amb dades de demo, és possible que Odoo deshabilite la possibilitat de tornar-les a instal·lar. Això és el field demo de ir.module.module que és readonly, per tant, cal modificar-lo a ma en la base de dades:</p>
<p><code class="docutils literal notranslate"><span class="pre">update ir_module_module set demo = 't' where name='school';</span></code></p>
</div>
<p>Més informació: <a class="reference external" href="https://www.odoo.com/documentation/master/developer/reference/backend/data.html">https://www.odoo.com/documentation/master/developer/reference/backend/data.html</a></p>
</section>
</section>
<section id="accions-i-menus">
<h2>Accions i menús<a class="headerlink" href="#accions-i-menus" title="Link to this heading">#</a></h2>
<p>Si vols conèixer en més detall cóm funcionen les accions en Odoo, llig
l’article <strong>Accions i menús en Odoo</strong></p>
<p>El client web de Odoo conté uns menús dalt i a l’esquerra. Aquests
menús, al ser accionats mostren altres menús i les pantalles del
programa. Quant pulsem en un menú, canvia la pantalla perquè hem fet una
<a class="reference external" href="https://www.odoo.com/documentation/master/developer/reference/backend/actions.html">acció</a>.</p>
<p>Una acció bàsicament té:</p>
<ul class="simple">
<li><p><strong>type</strong>: El tipus d’acció que és i cóm l’acció és interpretada.
Quan la definim en el XML, el type no cal especificar-lo, ja que ho
indica el model en que es guarda.</p></li>
<li><p><strong>name</strong>: El nom, que pot ser mostrat en la pantalla o no. Es
recomana que siga llegible per els humans.</p></li>
</ul>
<p>Les accions i els menús es declaren en fitxers de dades en XML o
dirèctament si una funció retorna un diccionari que la defineix. Les
accions poden ser cridades de tres maneres:</p>
<ul class="simple">
<li><p>Fent clic en un menú.</p></li>
<li><p>Fent clic en botons de les vistes (han d’estar connectats amb
accions).</p></li>
<li><p>Com accions contextuals en els objectes.</p></li>
</ul>
<p>D’aquesta manera, el client web pot saber quina acció ha d’executar si
rep alguna d’aquestes coses:</p>
<ul class="simple">
<li><p><strong>false</strong>: Indica que s’ha de tancar el diàleg actual.</p></li>
<li><p><strong>Una string</strong>: Amb l’etiqueta de <strong>l’acció de client</strong> a
executar.</p></li>
<li><p><strong>Un número</strong>: Amb el ID o external ID de l’acció a trobar a la
base de dades.</p></li>
<li><p><strong>Un diccionari</strong>: Amb la definició de l’acció, aquesta no està ni
en XML ni en la base de dades. En general, és la manera de cridar a
un action al finalitzar una funció.</p></li>
</ul>
<section id="accions-tipus-window">
<h3>Accions tipus <em>window</em><a class="headerlink" href="#accions-tipus-window" title="Link to this heading">#</a></h3>
<p>Les accions <em>window</em> són un record més (<strong>ir.actions.act_window</strong>). No
obstant, els menús que les criden, tenen una manera més ràpida de ser
declarats amb una etiqueta <strong>menuitem</strong>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;action_list_ideas&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Ideas<span class="nt">&lt;/field&gt;</span>
<span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>idea.idea<span class="nt">&lt;/field&gt;</span>
<span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
<span class="nt">&lt;/record&gt;</span>
<span class="nt">&lt;menuitem</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;menu_ideas&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;menu_root&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Ideas&quot;</span><span class="w"> </span><span class="na">sequence=</span><span class="s">&quot;10&quot;</span>
<span class="w">          </span><span class="na">action=</span><span class="s">&quot;action_list_ideas&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Les accions han de ser declarades al XML abans que els menús que les accionen.</p>
</div>
<p>Exemple:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;openerp&gt;</span>
<span class="w">    </span><span class="nt">&lt;data&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- window action --&gt;</span>
<span class="w">        </span><span class="cm">&lt;!--</span>
<span class="cm">            The following tag is an action definition for a &quot;window action&quot;,</span>
<span class="cm">            that is an action opening a view or a set of views</span>
<span class="cm">        --&gt;</span>
<span class="w">        </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;course_list_action&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Courses<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>openacademy.course<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_type&quot;</span><span class="nt">&gt;</span>form<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;help&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;p</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;oe_view_nocontent_create&quot;</span><span class="nt">&gt;</span>Create<span class="w"> </span>the<span class="w"> </span>first<span class="w"> </span>course
<span class="w">                </span><span class="nt">&lt;/p&gt;</span>
<span class="w">            </span><span class="nt">&lt;/field&gt;</span>
<span class="w">        </span><span class="nt">&lt;/record&gt;</span>

<span class="w">        </span><span class="cm">&lt;!-- top level menu: no parent --&gt;</span>
<span class="w">        </span><span class="nt">&lt;menuitem</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;main_openacademy_menu&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Open Academy&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- A first level in the left side menu is needed</span>
<span class="cm">             before using action= attribute --&gt;</span>
<span class="w">        </span><span class="nt">&lt;menuitem</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;openacademy_menu&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Open Academy&quot;</span>
<span class="w">                  </span><span class="na">parent=</span><span class="s">&quot;main_openacademy_menu&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- the following menuitem should appear *after*</span>
<span class="cm">             its parent openacademy_menu and *after* its</span>
<span class="cm">             action course_list_action --&gt;</span>
<span class="w">        </span><span class="nt">&lt;menuitem</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;courses_menu&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Courses&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;openacademy_menu&quot;</span>
<span class="w">                  </span><span class="na">action=</span><span class="s">&quot;course_list_action&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- Full id location:</span>
<span class="cm">             action=&quot;openacademy.course_list_action&quot;</span>
<span class="cm">             It is not required when it is the same module --&gt;</span>
<span class="w">    </span><span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/openerp&gt;</span>
</pre></div>
</div>
<p>Sols el tercer nivell de menús pot tindre associada un action. El primer
és el menú de dalt i el segon no es ‘clicable’.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>El que hem vist en esta secció és la definició d’una acció en un XML com a part de la vista, però una acció no és més que una forma còmoda d’escriure moltes coses que farà el client en javascript per demanar alguna cosa al servidor. Els actions separen i simplifiquen el desenvolupament de la interfície d’usuari que és el client web. Un menú o botó en html acciona una funció javascript que en principi no sap el que fer. Aquesta demana que es carregue la definició del seu action. Una vegada carregada la definició, queda clar tot el que ha de demanar (les vistes, context, dominis, vistes search, lloc on carregar-ho tot…) aleshores demana les vistes i amb ajuda de les vistes i els fields, demana els records que són les dades a mostrar. Per tant, un action és la definició sense programar javascript de coses que ha de fer el javascript. Odoo permet declarar actions com a resposta de funcions. Aquestes actions no estan en la base de dades, però són enviades igualment al client i el client fa en elles el mateix que en un action que ell ha demanat. Un exemple d’això són els actions que retornen els botons dels wizards. De fet, podem fer que un botó torne un action i, per tant, obrir una vista diferent.</p>
</div>
</section>
</section>
<section id="la-vista">
<h2>La vista<a class="headerlink" href="#la-vista" title="Link to this heading">#</a></h2>
<p>Per saber més sobre les vistes i cómo millorar-les, consulta l’article
de <strong>La vista en Odoo</strong></p>
</section>
<section id="herencia">
<h2>Herència<a class="headerlink" href="#herencia" title="Link to this heading">#</a></h2>
<p>El framework d’Odoo facilita el mecanisme de l’herència per tal que els
programadors puguin adaptar mòduls existents i garantir a la vegada que
les actualitzacions dels mòduls no destrossin les adequacions
desenvolupades.</p>
<p>L’herència es pot aplicar en els tres components del patró MVC:</p>
<ul class="simple">
<li><p>En el model: possibilita ampliar les classes existents o dissenyar
noves classes a partir de les existents.</p></li>
<li><p>En la vista: possibilita modificar el comportament de vistes
existents o dissenyar noves vistes.</p></li>
<li><p>En el controlador: possibilita sobreescriure els mètodes existents o
dissenyar-ne de nous.</p></li>
</ul>
<p>OpenObject proporciona tres mecanismes d’herència: l’herència de classe,
l’herència per prototip i l’herència per delegació.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Mecanisme</strong></p></th>
<th class="head"><p><strong>Característiques</strong></p></th>
<th class="head"><p><strong>Com es defineix</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>De classe</strong></p></td>
<td><p>- Herència simple. <br>- La classe original queda substituïda o ampliada.  <br>- Afegeix noves funcionalitats (atributs i/o mètodes) a la classe original.  <br>- Les vistes definides sobre la classe original continuen funcionant.  <br>- Permet sobreescriure mètodes de la classe original.  <br>- En PostgreSQL, continua mapada en la mateixa taula que la classe original, ampliada amb els nous atributs que pugui incorporar.</p></td>
<td><p>- S’utilitza l’atribut <code class="docutils literal notranslate"><span class="pre">_inherit</span></code> en la definició de la nova classe Python: <code class="docutils literal notranslate"><span class="pre">_inherit</span> <span class="pre">=</span> <span class="pre">'obj'</span></code>.  <br>- El nom de la nova classe ha de continuar sent el mateix que el de la classe original: <code class="docutils literal notranslate"><span class="pre">_name</span> <span class="pre">=</span> <span class="pre">'obj'</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Per prototip</strong></p></td>
<td><p>- Herència simple.  <br>- Aprofita la definició de la classe original (com si fos un «prototipus»).  <br>- La classe original continua existint.  <br>- Afegeix noves funcionalitats (atributs i/o mètodes) a les aportades per la classe original.  <br>- Les vistes definides sobre la classe original no existeixen (cal dissenyar-les de nou).  <br>- Permet sobreescriure mètodes de la classe original.  <br>- En PostgreSQL, queda mapada en una nova taula.</p></td>
<td><p>- S’utilitza l’atribut <code class="docutils literal notranslate"><span class="pre">_inherit</span></code> en la definició de la nova classe Python: <code class="docutils literal notranslate"><span class="pre">_inherit</span> <span class="pre">=</span> <span class="pre">'obj'</span></code>.  <br>- Cal indicar el nom de la nova classe: <code class="docutils literal notranslate"><span class="pre">_name</span> <span class="pre">=</span> <span class="pre">'nou_nom'</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Per delegació</strong></p></td>
<td><p>- Herència simple o múltiple.  <br>- La nova classe «delega» certs funcionaments a altres classes que incorpora a l’interior.  <br>- Els recursos de la nova classe contenen un recurs de cada classe de la que deriven.  <br>- Les classes base continuen existint.  <br>- Afegeix les funcionalitats pròpies (atributs i/o mètodes) que correspongui.  <br>- Les vistes definides sobre les classes bases no existeixen a la nova classe.  <br>- En PostgreSQL, queda mapada en diferents taules: una taula per als atributs propis, mentre que els recursos de les classes derivades resideixen en les taules corresponents a les dites classes.</p></td>
<td><p>- S’utilitza l’atribut <code class="docutils literal notranslate"><span class="pre">_inherits</span></code> en la definició de la nova classe Python: <code class="docutils literal notranslate"><span class="pre">_inherits</span> <span class="pre">=</span> <span class="pre">{'obj':</span> <span class="pre">'field_id'}</span></code>.  <br>- Cal indicar el nom de la nova classe: <code class="docutils literal notranslate"><span class="pre">_name</span> <span class="pre">=</span> <span class="pre">'nou_nom'</span></code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>```{figure} imgs/Inheritance_methods.png
:scale: 100 %
:alt: Herència

Diferents modes d&#39;herència
```
</pre></div>
</div>
<section id="herencia-en-el-model">
<h3>Herència en el Model<a class="headerlink" href="#herencia-en-el-model" title="Link to this heading">#</a></h3>
<p>El disseny d’un model d’Odoo heretat és paregut al disseny d’un no heretat; únicament hi ha dues diferències:</p>
<ul class="simple">
<li><p>Apareix l’atribut <strong>_inherit</strong> o <strong>_inherits</strong> per indicar
l’objecte (herència simple) o els objectes (herència múltiple) dels
quals deriva el nou objecte. La sintaxi a seguir és:</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">_inherit = 'nom.objecte.del.que.es.deriva'</span></code><br />
<code class="docutils literal notranslate"><span class="pre">_inherits = {'nom.objecte1':'nom_camp_FK1', ...}</span></code></p>
<ul class="simple">
<li><p>En cas d’herència simple, el nom (atribut _name) de l’objecte
derivat pot coincidir o no amb el nom de l’objecte pare. També és
possible no indicar l’atribut _name, fet que indica que el nou
objecte manté el nom de l’objecte pare.</p></li>
</ul>
<p>L’herència simple (_inherit) amb atribut _name idèntic al de l’objecte
pare, s’anomena herència de classe i en ella el nou objecte substitueix
l’objecte pare, tot i que les vistes sobre l’objecte pare continuen
funcionant. Aquest tipus d’herència, la més habitual, s’utilitza quan es
vol afegir <em>fields</em> i/o modificar propietats de dades existents i/o
modificar el funcionament d’alguns mètodes. En cas d’afegir dades,
aquestes s’afegeixen a la taula de la base de dades en la qual estava
mapat l’objecte pare.</p>
<p><strong>Exemple d’herència de classe</strong> L’herència de classe la trobem en
molts mòduls que afegeixen dades i mètodes a objectes ja existents, com
per exemple, el mòdul comptabilitat (account) que afegix dades i mètodes
a l’objecte res.partner. Fixem-nos en el contingut del mòdul account:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">res_partner</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;res.partner&#39;</span>
    <span class="n">debit_limit</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="s1">&#39;Payable limit&#39;</span><span class="p">)</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Podeu comprovar que la taula res_partner d’una empresa sense el mòdul
account instal·lat no conté el camp debit_limit, que en canvi sí que hi
apareix una vegada instal·lat el mòdul.</p>
<p>Odoo té molts mòduls que deriven de l’objecte res.partner per afegir-hi
característiques i funcionalitats.</p>
<p>L’herència simple (_inherit) amb atribut <strong>_name</strong> diferent al de
l’objecte pare, s’anomena <strong>herència per prototip</strong> i en ella es crea un
nou objecte que aglutina les dades i mètodes que tenia l’objecte del
qual deriva, juntament amb les noves dades i mètodes que pugua
incorporar el nou objecte. En aquest cas, sempre es crea una nova taula
a la base de dades per mapar el nou objecte.</p>
<p><strong>Exemple d’herència per prototip</strong> L’herència per prototip és difícil
de trobar en els mòduls que incorpora Odoo. Un exemple el tenim en el
mòdul base_calendar en el qual podem observar el mòdul comptabilitat
(account) que afegix dades i mètodes a l’objecte res.partner. Fixem-nos
en el contingut del mòdul account:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">res_alarm</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;res.alarm&#39;</span>
    <span class="o">...</span>
    <span class="k">class</span> <span class="nc">calendar_alarm</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;calendar.alarm&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;res.alarm&#39;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>En una empresa que tingui el mòdul base_calendar instal·lat podeu
comprovar l’existència de la taula res_alarm amb els camps definits a
l’apartat _atributs de la classe res_alarm i la taula calendar_alarm
amb camps idèntics als de la taula res_alarm més els camps definits a
l’apartat _atributs de la classe calendar_alarm.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>L’herència per prototip és la tradicional en els llenguatges orientats a objectes, ja que crea una nova classe vinculada</p>
</div>
<p>L’herència múltiple (_inherits) s’anomena herència per delegació i
sempre provoca la creació d’una nova taula a la base de dades. L’objecte
derivat ha d’incloure, per cada derivació, un camp many2one apuntant
l’objecte del qual deriva, amb la propietat <strong>ondelete=’cascade</strong>’.
L’herència per delegació obliga que cada recurs de l’objecte derivat
apunte a un recurs de cadascun dels objectes dels quals deriva i es pot
donar el cas que hi hagi diversos recursos de l’objecte derivat que
apunten a un mateix recurs per algun dels objectes dels quals deriva.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">res_alarm</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;res.alarm&#39;</span>
    <span class="o">...</span>
    <span class="k">class</span> <span class="nc">calendar_alarm</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;calendar.alarm&#39;</span>
    <span class="n">_inherits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;res.alarm&#39;</span><span class="p">:</span><span class="s1">&#39;alarm_id&#39;</span><span class="p">}</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="herencia-en-la-vista">
<h3>Herència en la vista<a class="headerlink" href="#herencia-en-la-vista" title="Link to this heading">#</a></h3>
<p>L’herència de classe possibilita continuar utilitzant les vistes
definides sobre l’objecte pare, però en moltes ocasions interessa
disposar d’una versió retocada. En aquest cas, és molt millor heretar de
les vistes existents (per afegir, modificar o eliminar camps) que
reemplaçar-les completament.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;id_xml_vista_pare&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>En cas que la vista id_xml_vista_pare estiga en un mòdul diferent del
que estem dissenyant, cal afegir el nom del mòdul al davant:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;modul.id_xml_vista_pare&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>El motor d’herència d’OpenObject, en trobar una vista heretada, processa
el contingut de l’element arch. Per cada fill d’aquest element que
tingui algun atribut, OpenObject cerca a la vista pare una etiqueta amb
atributs coincidents (excepte el de la posició) i, a continuació,
combina els camps de la vista pare amb els de la vista heretada i
estableix la posició de les noves etiquetes a partir dels següents
valors:</p>
<ul class="simple">
<li><p>inside (per defecte): els valors s’afegeixen “dins” de l’etiqueta.</p></li>
<li><p>after: afegeix el contingut després de l’etiqueta.</p></li>
<li><p>before: afegeix el contingut abans de l’etiqueta.</p></li>
<li><p>replace: reemplaça el contingut de l’etiqueta.</p></li>
<li><p>attributes: Modifica <a class="reference external" href="https://www.odoo.com/es_ES/forum/ayuda-1/question/xpath-how-to-replace-attributes-only-and-not-the-full-field-38192">els
atributs</a>.</p></li>
</ul>
<p><strong>Reemplaçar</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;replace&quot;</span><span class="nt">&gt;</span>
<span class="w">     </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nou_camp&quot;</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;/field&gt;</span>
<span class="w"> </span><span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
<p><strong>Esborrar</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;replace&quot;</span><span class="nt">/&gt;</span>
<span class="w"> </span><span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
<p><strong>Inserir nous camps</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;before&quot;</span><span class="nt">&gt;</span>
<span class="w">       </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nou_camp&quot;</span><span class="w"> </span><span class="err">...</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/field&gt;</span>
<span class="w"> </span><span class="nt">&lt;/field&gt;</span>

<span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="w"> </span><span class="na">style=</span><span class="s">&quot;font-family:monospace&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
<span class="w">       </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nou_camp&quot;</span><span class="w"> </span><span class="err">...</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/field&gt;</span>
<span class="w"> </span><span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
<p><strong>Fer combinacions</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;data&gt;</span>
<span class="w">     </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp1&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;after&quot;</span><span class="nt">&gt;</span>
<span class="w">       </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nou_camp1&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;/field&gt;</span>
<span class="w">     </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp2&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;replace&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;camp3&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;before&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nou_camp3&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;/field&gt;</span>
<span class="w">   </span><span class="nt">&lt;/data&gt;</span>
<span class="w"> </span><span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
<p>Per definir la posició dels elements que afegim, podem utilitzar una
expresió <strong>xpath</strong>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;xpath</span><span class="w"> </span><span class="na">expr=</span><span class="s">&quot;//field[@name=&#39;order_line&#39;]/tree/field[@name=&#39;price_unit&#39;]&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;before&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xpath</span><span class="w"> </span><span class="na">expr=</span><span class="s">&quot;//form/*&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;before&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;header&gt;</span>
<span class="w">    </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;status&quot;</span><span class="w"> </span><span class="na">widget=</span><span class="s">&quot;statusbar&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/header&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xpath&gt;</span>
</pre></div>
</div>
<p>És posssible que necessitem una vista totalment nova de l’objecte
heredat. Si fem un action normal en l’XML es veuran els que més
prioritat tenen. Si volem especificar quina vista volem en concret hem
d’utilitzar <strong>view_ids</strong>, observem aquest exemple:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;terraform.player_action_window&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Players<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>res.partner<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form,kanban<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_ids&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;[(5, 0, 0),</span>
<span class="s">            (0, 0, {&#39;view_mode&#39;: &#39;tree&#39;, &#39;view_id&#39;: ref(&#39;terraform.player_tree&#39;)}),</span>
<span class="s">            (0, 0, {&#39;view_mode&#39;: &#39;form&#39;, &#39;view_id&#39;: ref(&#39;terraform.player_form&#39;)}),]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p>En <strong>(0,0,{registre_a_crear})</strong> li diguem que a eixe Many2many hi ha
que afegir un nou registre amb eixes dades en concret. El que necessita
és el <strong>view_mode</strong> i el <strong>view_id</strong>, com en els records anteriors.</p>
<p>Si es vol especificar una vista search es pot inclourer la etiqueta
<strong>search_view_id</strong>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;search_view_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;cine.pos_order_line_search_view&quot;</span><span class="nt">/&gt;</span><span class="w">  </span>
</pre></div>
</div>
<p><strong>Domains</strong></p>
<p>Si volem que el action heredat sols mostre els elements que volem, s’ha
de ficar un domain en el action:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;</span><span class="w"> </span>[(&#39;isplayer&#39;,&#39;=&#39;,True)]<span class="nt">&lt;/field&gt;</span><span class="w"> </span>
</pre></div>
</div>
<p>Amés, es pot dir que, per defecte, quan es crea un nou registre a través
d’aquest action, tinga el field a True:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;context&quot;</span><span class="nt">&gt;</span>{&#39;default_is_player&#39;:<span class="w"> </span>True}<span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
<p><strong>Filtre per defecte</strong></p>
<p>El problema en la solució anterior és que lleva la possibilitat de veure
el que no tenen aquest field a True i cal anar per un altre action a
modificar-los. Si volem poder veure tots, podem crear un filtre en la
vista search i en l’action dir que volem aquest filtre per defecte:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!--   En la vista search --&gt;</span>
...
<span class="w">    </span><span class="nt">&lt;search&gt;</span>
<span class="w">        </span><span class="nt">&lt;filter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;player_partner&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;Is Player&quot;</span><span class="w"> </span><span class="na">domain=</span><span class="s">&quot;[(&#39;is_player&#39;,&#39;=&#39;,True)]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/search&gt;</span>
...
<span class="cm">&lt;!-- En l&#39;action --&gt;</span>
<span class="w">            </span><span class="cm">&lt;!--  &lt;field name=&quot;domain&quot;&gt; [(&#39;is_player&#39;,&#39;=&#39;,True)]&lt;/field&gt; --&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;context&quot;</span><span class="nt">&gt;</span>{&#39;default_is_player&#39;:<span class="w"> </span>True,<span class="w"> </span>&#39;search_default_player_partner&#39;:<span class="w"> </span>1}<span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
<p>Per tant, un action complet per a vistes personalitzades i amb filtres quedarà com aquest:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.actions.act_window&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;terraform.player_action_window&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Players<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;res_model&quot;</span><span class="nt">&gt;</span>res.partner<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_mode&quot;</span><span class="nt">&gt;</span>tree,form,kanban<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;domain&quot;</span><span class="nt">&gt;&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;context&quot;</span><span class="nt">&gt;</span>{&#39;default_is_player&#39;:<span class="w"> </span>True,<span class="w"> </span>&#39;search_default_player_partner&#39;:<span class="w"> </span>1}<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;view_ids&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;[(5, 0, 0),</span>
<span class="s">            (0, 0, {&#39;view_mode&#39;: &#39;tree&#39;, &#39;view_id&#39;: ref(&#39;terraform.player_tree&#39;)}),</span>
<span class="s">            (0, 0, {&#39;view_mode&#39;: &#39;form&#39;, &#39;view_id&#39;: ref(&#39;terraform.player_form&#39;)}),]&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
</section>
<section id="herencia-en-el-controlador">
<h3>Herència en el controlador<a class="headerlink" href="#herencia-en-el-controlador" title="Link to this heading">#</a></h3>
<p>L’herència en el controlador és un mecanisme conegut, ja que l’apliquem
de forma inconscient quan ens veiem obligats a sobreescriure els mètodes
de la capa ORM d’OpenObject en el disseny de molts mòduls.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Funció super()</p>
<p>El llenguatge Python recomana utilitzar la funció super() per invocar el mètode de la classe base quan s’està sobreescrivint en una classe derivada, en lloc d’utilitzar la sintaxi nomClasseBase.metode(self…).</p>
</div>
<p>L’efecte de l’herència en el controlador es manifesta únicament quan cal
sobreescriure algun dels mètodes de l’objecte del qual es deriva i per a
fer-ho adequadament cal tenir en compte que el mètode sobreescrit en
l’objecte derivat:</p>
<ul class="simple">
<li><p>De vegades vol substituir el mètode de l’objecte base sense
aprofitar-ne cap funcionalitat: el mètode de l’objecte derivat no
invoca el mètode sobreescrit.</p></li>
<li><p>De vegades vol aprofitar la funcionalitat del mètode de l’objecte
base: el mètode de l’objecte derivat invoca el mètode sobreescrit.</p></li>
</ul>
<p>Exemples:</p>
<p><a class="reference external" href="http://www.odoo.yenthevg.com/override-create-functions-odoo/">Sobreescriure el mètode
<strong>create</strong></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">res_partner</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;res.partner&#39;</span>
    <span class="n">passed_override_write_function</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Has passed our super method&#39;</span><span class="p">)</span>
 
    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="c1"># Override the original create function for the res.partner model</span>
        <span class="n">record</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">res_partner</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
 
        <span class="c1"># Change the values of a variable in this super function</span>
        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;passed_override_write_function&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span> <span class="s1">&#39;Passed this function. passed_override_write_function value: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;passed_override_write_function&#39;</span><span class="p">])</span>
 
        <span class="c1"># Return the record so that the changes are applied and everything is stored.</span>
    <span class="k">return</span> <span class="n">record</span>
</pre></div>
</div>
</section>
</section>
<section id="el-controlador">
<h2>El controlador<a class="headerlink" href="#el-controlador" title="Link to this heading">#</a></h2>
<p>Part del controlador l’hem mencionat al parlar dels camps <strong>computed</strong>.
No obstant, cal comentar les facilitats que proporciona Odoo per a no
tindre que accedir dirèctament a la base de dades.</p>
<p>La capa <strong>ORM</strong> d’Odoo facilita uns mètodes que s’encarreguen del
mapatge entre els objectes Python i les taules de PostgreSQL. Així,
disposem de mètodes per crear, modificar, eliminar i cercar registres a
la base de dades.</p>
<p>En ocasions, pot ser necessari alterar l’acció automàtica de cerca –
creació – modificació – eliminació facilitada per Odoo i haurem de
sobreescriure els corresponents mètodes en les nostres classes.</p>
<p>Els programadors en el framework d’Odoo hem de conèixer els mètodes
subministrats per la capa ORM i hem de dominar el disseny de mètodes
per:</p>
<ul class="simple">
<li><p>Poder definir camps funcionals en el disseny del model.</p></li>
<li><p>Poder definir l’acció que cal executar en modificar el contingut
d’un field d’una vista form (&#64;api.onchange)</p></li>
<li><p>Poder alterar les accions automàtiques de cerca, creació,
modificació i eliminació de recursos.</p></li>
</ul>
<p>Una darrera consideració a tenir en compte en l’escriptura de mètodes i
funcions en Odoo és que els textos de missatges inclosos en mètodes i
funcions, per poder ser traduïbles, han de ser introduïts amb la sintaxi
_(‘text’) i el fitxer .py ha de contenir from tools.translate import
_ a la capçalera.</p>
<section id="api-de-l-orm">
<h3>API de l’ORM<a class="headerlink" href="#api-de-l-orm" title="Link to this heading">#</a></h3>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p><strong>Interactuar en la terminal</strong>
$ odoo shell -d castillo -u containers</p>
<p>Observa cóm hem ficat el paràmetre ‘’’shell’’’. Les coses que se fan en la terminal no són persistents en la base de dades fins que no s’executa ‘’’self.env.cr.commit()’’’. Dins de la terminal podem obtindre ajuda dels mètodes d’Odoo amb help(), per exemple: help(tools.image)
Amb el següent exemple, podem arrancar odoo sense molestar a l’instància que està en marxa redefinint els ports:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ odoo shell -c /path/to/odoo.conf --xmlrpc-port 8888 --longpolling-port 8899
</pre></div>
</div>
<p><a class="reference external" href="https://asciinema.org/a/123126">https://asciinema.org/a/123126</a> (Asciinema amb alguns exemples)</p>
</div>
<p>Un mètode creat dins d’un model actua sobre tots els elements del model
que estiguen actius en el moment de cridar al mètode. Si és un tree,
seran molts i si és un form sols un. Però en qualsevol cas és una
‘llista’ d’elements i es diu <strong>recordset</strong>.</p>
<p>Bàsicament la interacció amb els models en el controlador es fa amb els
anomenats <strong>recordsets</strong> que són col·leccions d’objectes sobre un
model. Si iterem dins dels recordset , obtenim els <strong>singletons</strong>, que
són objectes individuals de cada línia en la base de dades.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">print</span> <span class="bp">self</span> <span class="c1"># =&gt; a.model(1, 2, 3, 4, 5)</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
        <span class="nb">print</span> <span class="n">record</span> <span class="c1"># =&gt; a.model(1), then a.model(2), then a.model(3), ...</span>
</pre></div>
</div>
<p>Podem accedir a tots els fields d’un model sempre que estem en un
singleton, no en un recordset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">record</span><span class="o">.</span><span class="n">name</span>
<span class="go">Example Name</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">record</span><span class="o">.</span><span class="n">company_id</span><span class="o">.</span><span class="n">name</span>
<span class="go">Company Name</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Bob&quot;</span>
</pre></div>
</div>
<p>Intentar llegir o escriure un field en un recordset donarà un error.
Accedir a un <strong>many2one, one2many o many2many</strong> donarà un recordset.</p>
<section id="set-operations">
<h4>Set operations<a class="headerlink" href="#set-operations" title="Link to this heading">#</a></h4>
<p>Els recordsets es poden combinar amb operacions específiques que són les
típiques dels conjunts:</p>
<ul class="simple">
<li><p><strong>record in set</strong> retorna si el record està en el set</p></li>
<li><p><strong>set1 | set2</strong> Unió de sets</p></li>
<li><p><strong>set1 &amp; set2</strong> Intersecció de sets</p></li>
<li><p><strong>set1 - set2</strong> Diferència de sets</p></li>
</ul>
<p>Amés, un recordset no té elements repetits i permet accedir a recordsets
dins d’ell. Per exemple:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">record</span><span class="o">.</span><span class="n">students</span><span class="o">.</span><span class="n">classrooms</span>
</pre></div>
</div>
<p>Dona la llista de totes les classes de tots els estudiants i sense
repetir cap.</p>
</section>
<section id="programacio-funcional-en-l-orm">
<h4>Programació funcional en l’ORM<a class="headerlink" href="#programacio-funcional-en-l-orm" title="Link to this heading">#</a></h4>
<p>Python té una serie de funcions que permeten iterar una llista i aplicar
una funció als elements. Les més utilitzades són map(), filter(),
reduce(), sort(), zip()… Odoo treballa en recordsets, no llistes, i
té les seues funcions pròpies per a imitar aquestes:</p>
<ul class="simple">
<li><p><strong>filtered()</strong> Filtra el recordset de manera que sols tinga els
records que complixen una condició.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">records</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">company_id</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">company_id</span><span class="p">)</span>
<span class="n">records</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="s2">&quot;partner_id.is_company&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>sorted()</strong> Ordena segons uns funció, se defineix una funció lambda
(key) que indica que s’ordena per el camp name:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># sort records by name</span>
<span class="n">records</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="n">records</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>mapped()</strong> Li aplica una funció a cada recordset i retorna un
recordset amb els canvis demanats:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># returns a list of summing two fields for each record in the set</span>
<span class="n">records</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">field1</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">field2</span><span class="p">)</span>
<span class="c1"># returns a list of names</span>
<span class="n">records</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="c1"># returns a recordset of partners</span>
<span class="n">record</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;partner_id&#39;</span><span class="p">)</span>
<span class="c1"># returns the union of all partner banks, with duplicates removed</span>
<span class="n">record</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;partner_id.bank_ids&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Aquestes funcions són útils per a fer tècniques de <a class="reference external" href="https://docs.python.org/3.7/howto/functional.html">programació
funcional</a></p>
</section>
<section id="enviroment">
<h4>Enviroment<a class="headerlink" href="#enviroment" title="Link to this heading">#</a></h4>
<p>L’anomenat enviroment o <strong>env</strong> guarda algunes dades contextuals
interessants per a treballar amb l’ORM, com ara el cursor a la base de
dades, l’usuari actual o el context (que guarda algunes metadades).</p>
<p>Tots els recordsets tenen un enviroment accesible amb env. Quant volem
crear un recordset dins d’un altre, podem usar env:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
<span class="go">res.partner</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([[</span><span class="s1">&#39;is_company&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;customer&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">]])</span>
<span class="go">res.partner(7, 18, 12, 14, 17, 19, 8, 31, 26, 16, 13, 20, 30, 22, 29, 15, 23, 28, 74)</span>
</pre></div>
</div>
<p>El primer cas crea un recordset buit però que fa referència a
res.partner i es poden fer les funcions de l’ORM que necessitem.</p>
<section id="context">
<h5>Context<a class="headerlink" href="#context" title="Link to this heading">#</a></h5>
<p>El context és un diccionari de python que conté dades útils per a totes
les vistes i els mètodes. Les funcions d’Odoo reben el context i el
consulten si cal. Context pot tindre de tot, però quasi sempre té al
menys el user ID, l’idioma o la zona temporal. Quant Odoo va a
renderitzar una vista XML, consulta el context per veure si ha
d’aplicar algun paràmetre.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>Al llarg de tot aquest manual utilitzem sovint paràmetres del context.
Aquests són els paràmetres que hem utilitzat en algun moment:</p>
<ul class="simple">
<li><p>active_id : self._context.get(‘active_id’) es tracta de l’id de
l’element del model que està en pantalla.</p></li>
<li><p>active_ids : Llista de les id seleccionats en un tree.</p></li>
<li><p>active_model : El model actual.</p></li>
<li><p>default_<code class="docutils literal notranslate"><span class="pre">&lt;field&gt;</span></code>{=html} : En un action o en un one2many es pot
assignar un valor per defecte a un field.</p></li>
<li><p>search_default_<code class="docutils literal notranslate"><span class="pre">&lt;filter&gt;</span></code>{=html} : Per aplicar un filtre per
defecte a la vista en un <strong>action</strong>.</p></li>
<li><p>group_by : Dins d’un camp <strong>filter</strong> per a crear agrupacions en les
vistes <strong>search</strong>.</p></li>
<li><p>graph_mode : En les vistes <strong>graph</strong>, aquest paràmetre canvia el
<strong>type</strong></p></li>
<li><p>context.get : En les vistes es pot treure algunes dades del context
per a mostrar condicionalment o per als <em>domains</em></p></li>
</ul>
<p>El context va passant d’un mètode a un altre o a les vistes i, de
vegades volem modificar-lo.</p>
<p>Imaginem que volem fer un botó que obriga un
wizard, però volem passar-li <strong>paràmetres</strong>
al wizard. En els botons i fields relacionals es pot especificar un
context:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;%(reserves.act_w_clients_bookings)d&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;action&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;Select bookings&quot;</span><span class="w"> </span><span class="na">context=</span><span class="s">&quot;{&#39;b_fs&#39;:bookings_fs}&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Eixe action obre un wizard, que és un model transitori en el que podem
definir un field amb els continguts del context:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_default_bookings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;b_fs&#39;</span><span class="p">)</span>
<span class="n">bookings_fs</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;reserves.bookings&#39;</span><span class="p">,</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_default_bookings</span><span class="p">)</span>
</pre></div>
</div>
<p>Aquest many2many tindrà els mateixos elements que el form que l’ha
cridat. (Això és com el
<strong>default_</strong> en els
One2many, però fet a mà)</p>
<p>També es pot utilitzar aquesta manera d’enviar un recordset per un
context per al <strong>domain</strong> d’un field Many2one o Many2many:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_domain_bookings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;b_fs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ids</span><span class="p">)]</span>
<span class="n">bookings_fs</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;reserves.bookings&#39;</span><span class="p">,</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">_default_bookings</span><span class="p">)</span>
</pre></div>
</div>
<p>En ocasions necessitem especificar valors per defecte i filtres per
defecte en un <strong>action</strong>. Per exemple, quan implementem l’herència,
volem que els nous registres que es facen en el nostre <strong>action</strong>
tinguem un valor per defecte. En el següent exemple, en la primera línia
és el que es sol fer en la Herència i en la segona estem
especificant un External ID amb <strong>ref()</strong>
dins d’un eval.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;context&quot;</span><span class="o">&gt;</span><span class="p">{</span><span class="s1">&#39;default_is_player&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;search_default_player_partner&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">field</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;context&quot;</span> <span class="nb">eval</span><span class="o">=</span><span class="s2">&quot;{&#39;default_partner_id&#39;:ref(&#39;base.main_partner&#39;), &#39;company_hide&#39;:False, &#39;default_company_id&#39;:ref(&#39;base.main_company&#39;), &#39;search_default_my_bank&#39;:1}&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>El context és un diccionari inmutable (frozendict) que no pot ser
alterat en funcions. no obstant, si volem modificar el context actual
per enviar-lo a un action o cridar a una funció d’un model amb un altre
context, es pot fer amb
<strong><a class="reference external" href="https://www.odoo.com/documentation/11.0/reference/orm.html#odoo.models.Model.with_context">with_context</a></strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># current context is {&#39;key1&#39;: True}</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">({},</span> <span class="n">key2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># -&gt; r2._context is {&#39;key2&#39;: True}</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">key2</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># -&gt; r2._context is {&#39;key1&#39;: True, &#39;key2&#39;: True}</span>
</pre></div>
</div>
<p>Si és precís modificar el context es pot fer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
 <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;val&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>o</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">get_sizes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
 <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span>
</pre></div>
</div>
<p>Però no funciona més enllà del recordset actual. És a dir, no modifica
el context en el que s’ha cridat.</p>
<p>Si el que volem és passar el valor d’un field per context a un botó
dins d’una ‘subvista’, podem utilitzar el paràmetre <strong>parent</strong>, que
funciona tant en en <strong>domain</strong>, <strong>attr</strong>, com en context. Ací tenim un
exemple de tree dins d’un field amb botons que envíen per context coses
del pare:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;movies&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;tree&gt;</span>
<span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;photo_small&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;score&quot;</span><span class="w"> </span><span class="na">widget=</span><span class="s">&#39;priority&#39;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;book_it&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;Book it&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;object&quot;</span><span class="w"> </span><span class="na">context=</span><span class="s">&quot;{&#39;b_client&#39;:parent.client,&#39;b_day&#39;:parent.day}&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;/tree&gt;</span>
</pre></div>
</div>
<p>Podem passar el context per un action i el podem utilitzar en la vista,
ja que tenim l’objecte <strong>context</strong> disponible en QWeb. Si, per exemple,
volem retornar un action que cride a una vista i un field tinga un
domain passat per context:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>     <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Travel wizard action&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
            <span class="s1">&#39;res_model&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
            <span class="s1">&#39;res_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;view_mode&#39;</span><span class="p">:</span> <span class="s1">&#39;form&#39;</span><span class="p">,</span>
            <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span>
            <span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="p">,</span> <span class="n">cities_available_context</span><span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cities_available</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">ids</span><span class="p">),</span>
        <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w">           </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;destiny&quot;</span>
<span class="w">                  </span><span class="na">domain =</span><span class="w"> </span><span class="s">&quot;[(&#39;id&#39;,&#39;in&#39;,context.get(&#39;cities_available_context&#39;,[]))]&quot;</span>
<span class="w">                  </span><span class="nt">/&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="metodes-de-l-orm">
<h4>Mètodes de l’ORM<a class="headerlink" href="#metodes-de-l-orm" title="Link to this heading">#</a></h4>
<section id="search">
<h5>search()<a class="headerlink" href="#search" title="Link to this heading">#</a></h5>
<p>A partir d’un <strong>domain</strong> de Odoo, proporciona un recordset amb tots els
elements que coincideixen:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># searches the current model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;is_company&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;customer&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>
<span class="go">res.partner(7, 18, 12, 14, 17, 19, 8, 31, 26, 16, 13, 20, 30, 22, 29, 15, 23, 28, 74)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;is_company&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)],</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;Agrolait&#39;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Es pot obtindre la quantitat d’elements amb el mètode ‘’’search_count()’’’</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Parameters</span>
    <span class="n">args</span> <span class="o">--</span> <span class="n">A</span> <span class="n">search</span> <span class="n">domain</span><span class="o">.</span> <span class="n">Use</span> <span class="n">an</span> <span class="n">empty</span> <span class="nb">list</span> <span class="n">to</span> <span class="n">match</span> <span class="nb">all</span> <span class="n">records</span><span class="o">.</span>
    <span class="n">offset</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">--</span> <span class="n">number</span> <span class="n">of</span> <span class="n">results</span> <span class="n">to</span> <span class="n">ignore</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="n">none</span><span class="p">)</span>
    <span class="n">limit</span> <span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">--</span> <span class="n">maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">records</span> <span class="n">to</span> <span class="k">return</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="nb">all</span><span class="p">)</span>
    <span class="n">order</span> <span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">--</span> <span class="n">sort</span> <span class="n">string</span>
    <span class="n">count</span> <span class="p">(</span><span class="nb">bool</span><span class="p">)</span> <span class="o">--</span> <span class="k">if</span> <span class="kc">True</span><span class="p">,</span> <span class="n">only</span> <span class="n">counts</span> <span class="ow">and</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">matching</span> <span class="n">records</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="create">
<h5>create()<a class="headerlink" href="#create" title="Link to this heading">#</a></h5>
<p>Te dona un recordset a partir d’una definició de varis fields:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;New Name&quot;</span><span class="p">})</span>
<span class="go">res.partner(78)</span>
</pre></div>
</div>
<p>El mètode <strong>create</strong> s’utilitza sovint per a ser sobreescrit en
herència per fer coses en el moment de la creació. Ací tenim un exemple
en el que modifiquem el <strong>create</strong> d’un model per crear una instància
associada amb una imatge predefinida:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>     <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
     <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">new_id</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="nb">print</span> <span class="n">values</span>
        <span class="n">name_player</span> <span class="o">=</span> <span class="n">new_id</span><span class="o">.</span><span class="n">name</span>
        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;mmog.fortress&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;f1&#39;</span><span class="p">)])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">icon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;mmog.fortress&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">name_player</span><span class="o">+</span><span class="s2">&quot;-fortress&quot;</span><span class="p">,</span><span class="s1">&#39;level&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;soldiers&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;population&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;food&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span><span class="s1">&#39;integrity&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;id_player&#39;</span><span class="p">:</span><span class="n">new_id</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="s1">&#39;icon&#39;</span><span class="p">:</span><span class="n">img</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">new_id</span>
</pre></div>
</div>
</section>
<section id="write">
<h5>write()<a class="headerlink" href="#write" title="Link to this heading">#</a></h5>
<p>Escriu uns fields dins de tots els elements del recordset, no retorna
res:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Newer Name&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p><strong>Escriure en un many2many</strong>:</p>
<p>La manera més senzilla és passar una llista d’ids. Però si ja
existeixen elements abans, necessitem uns codis especials (vegeu
<a class="reference internal" href="#Odoo#Expressions"><span class="xref myst">Odoo#Expressions</span></a>):</p>
<p>Per exemple:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">4</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span> 
 <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;sessions&#39;</span><span class="p">:[(</span><span class="mi">4</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="p">)]})</span>
 <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;sessions&#39;</span><span class="p">:[(</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">,[</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;vehicle_tag_leasing&#39;</span><span class="p">),</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;fleet.vehicle_tag_compact&#39;</span><span class="p">),</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;fleet.vehicle_tag_senior&#39;</span><span class="p">)]</span> <span class="p">)]})</span>
</pre></div>
</div>
</section>
<section id="browse">
<h5>browse()<a class="headerlink" href="#browse" title="Link to this heading">#</a></h5>
<p>A partir d’una llista de ids, retorna un recordset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
<span class="go">res.partner(7, 18, 12)</span>
</pre></div>
</div>
</section>
<section id="exists">
<h5>exists()<a class="headerlink" href="#exists" title="Link to this heading">#</a></h5>
<p>Retorna si un record en concret encara està en la base de dades.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The record has been deleted&quot;</span><span class="p">)</span>
<span class="n">o</span><span class="p">:</span>
<span class="n">records</span><span class="o">.</span><span class="n">may_remove_some</span><span class="p">()</span>
<span class="c1"># only keep records which were not deleted</span>
<span class="n">records</span> <span class="o">=</span> <span class="n">records</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
</pre></div>
</div>
<p>En el segon exemple, refresca un recordset amb aquells que encara
existixen.</p>
</section>
<section id="ref">
<h5>ref()<a class="headerlink" href="#ref" title="Link to this heading">#</a></h5>
<p>Retorna un singleton a partir d’un <strong>External ID</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.group_public&#39;</span><span class="p">)</span>
<span class="go">res.groups(2)</span>
</pre></div>
</div>
</section>
<section id="ensure-one">
<h5>ensure_one()<a class="headerlink" href="#ensure-one" title="Link to this heading">#</a></h5>
<p>S’asegura de que el record en concret siga un singleton.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">records</span><span class="o">.</span><span class="n">ensure_one</span><span class="p">()</span>
<span class="c1"># is equivalent to but clearer than:</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Expected singleton&quot;</span>
</pre></div>
</div>
</section>
<section id="unlink">
<h5>unlink()<a class="headerlink" href="#unlink" title="Link to this heading">#</a></h5>
<p>Esborra de la base de dades els elements del recordset actual.</p>
<p>Exemple de cóm sobreescriure el mètode unlink per a esborrar en cascada:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">unlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">x</span><span class="o">.</span><span class="n">catid</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">product_uom_class</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>read()</strong> Es tracta d’un mètode de baix nivell per llegir un field en
concret dels records. És preferible emprar browse()</p>
<p><em>‘name_search(name=</em>, args=None, operator=’ilike’, limit=100)’’’ →
records Search for records that have a display name matching the given
name pattern when compared with the given operator, while also matching
the optional search domain (args).</p>
<p>This is used for example to provide suggestions based on a partial value
for a relational field. Sometimes be seen as the inverse function of
name_get(), but it is not guaranteed to be.</p>
<p>This method is equivalent to calling search() with a search domain based
on display_name and then name_get() on the result of the search.</p>
<p><strong>ids</strong> Llista dels ids del recordset actual.</p>
<p><strong>sorted(key=None, reverse=False)</strong> Retorna el recordset ordenat per un
criteri.</p>
<p><strong>display_name</strong>. Aquest atribut, per defecte, mostra el field <strong>name</strong>
si està. Es pot sobreescriure <code class="docutils literal notranslate"><span class="pre">_compute_display_name</span></code> per mostrar un altre camp o mescla
d’ells. També es pot canviar <code class="docutils literal notranslate"><span class="pre">_rec_name</span></code> per indicar un field distint de <code class="docutils literal notranslate"><span class="pre">name</span></code>.</p>
<p><strong>copy()</strong> Crea una còpia del singleton i permet aportar nous valors per
als fields de la copia.</p>
<p>En els fields <strong>One2many</strong> no es pot copiar per defecte, però es pot dir
<strong>copy=True</strong>.</p>
</section>
<section id="onchange">
<h5>onchange<a class="headerlink" href="#onchange" title="Link to this heading">#</a></h5>
<p>Si volem que un valor siga modificat en temps real quant modifiquem el
valor d’un altre field sense encara haver guardat, podem usar els
mètodes <strong>on_change</strong>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Els camps ‘’’computed’’’ ja tenen el seu propi onchange, per tant, no cal fer-lo</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Ha quedat “deprecated” retornar un domain <a class="github reference external" href="https://github.com/odoo/odoo/pull/41918#issuecomment-824946980">odoo/odoo#41918</a></p>
</div>
<p>En onchange es modifica el valor d’un o més camps dirèctament i, si cal
un filtre o un missatge, es fa en el return:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="p">{</span>
    <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Warning&quot;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;What is this?&quot;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;notification&#39;</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Si el <strong>type</strong> és <strong>notification</strong> es mostrarà en una notificació, en un
altre cas, en un dialog. (Odoo 13)</p>
<p>Exemples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># onchange handler</span>
<span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">,</span> <span class="s1">&#39;unit_price&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_onchange_price</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># set auto-changing field</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_price</span>
    <span class="c1"># Can optionally return a warning and domains</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Something bad happened&quot;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;It was very bad indeed&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;seats&#39;</span><span class="p">,</span> <span class="s1">&#39;attendee_ids&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_verify_valid_seats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
         <span class="k">return</span> <span class="p">{</span>
             <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
                 <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Incorrect &#39;seats&#39; value&quot;</span><span class="p">,</span>
                 <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;The number of available seats may not be negative&quot;</span><span class="p">,</span>
             <span class="p">},</span>          <span class="p">}</span>
     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seats</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attendee_ids</span><span class="p">):</span>
          <span class="k">return</span> <span class="p">{</span>
             <span class="s1">&#39;warning&#39;</span><span class="p">:</span> <span class="p">{</span>
                 <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s2">&quot;Too many attendees&quot;</span><span class="p">,</span>
                 <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;Increase seats or remove excess attendees&quot;</span><span class="p">,</span>
             <span class="p">},</span>
         <span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Si l’usuari s’equivoca introduint algunes dades, Odoo proporciona varies maneres d’evitar-lo:</p>
<ul class="simple">
<li><p>Constraints</p></li>
<li><p>onchange amb missatge d’error i restablint els valors originals</p></li>
<li><p>Sobreescriptura del mètode write o create per comprovar coses abans de guardar</p></li>
</ul>
</div>
</section>
<section id="cron-jobs">
<h5>Cron Jobs<a class="headerlink" href="#cron-jobs" title="Link to this heading">#</a></h5>
<p>Cal crear un record en el model ir.cron, per exemple:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.cron&quot;</span><span class="w"> </span><span class="na">forcecreate=</span><span class="s">&quot;True&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;game.cron_update&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Game:<span class="w"> </span>Cron<span class="w"> </span>Update<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;model_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;model_game_player&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;state&quot;</span><span class="nt">&gt;</span>code<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;</span>model.update_resources()<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;user_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;base.user_root&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;interval_number&quot;</span><span class="nt">&gt;</span>1<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;interval_type&quot;</span><span class="nt">&gt;</span>minutes<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;numbercall&quot;</span><span class="nt">&gt;</span>-1<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;activity_user_type&quot;</span><span class="nt">&gt;</span>specific<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;doall&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;False&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p>I un mètode amb el &#64;api.model i aquests arguments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
    <span class="k">def</span> <span class="nf">update_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
</pre></div>
</div>
<p><strong>ir.cron</strong> té un many2one amb <strong>ir.actions.server</strong> i, al ser creat,
crea l’acció de servidor corresponent. És important ficar en el
manifest que depén de <strong>mail</strong>, ja que és un mòdul preinstal·lat que
hereta i afegeix camps a <strong>ir.actions.server</strong>.</p>
<p><a class="reference external" href="https://poncesoft.blogspot.com/2018/05/creacion-metodos-automatizados-en-odoo.html">https://poncesoft.blogspot.com/2018/05/creacion-metodos-automatizados-en-odoo.html</a>
<a class="reference external" href="https://webkul.com/blog/creating-cron-server-action-odoo-11/">https://webkul.com/blog/creating-cron-server-action-odoo-11/</a>
<a class="reference external" href="https://odoo-development.readthedocs.io/en/latest/odoo/models/ir.cron.html">https://odoo-development.readthedocs.io/en/latest/odoo/models/ir.cron.html</a></p>
</section>
</section>
</section>
<section id="els-decoradors">
<h3>Els Decoradors<a class="headerlink" href="#els-decoradors" title="Link to this heading">#</a></h3>
<p>Com es veu, abans de moltes funcions es fica &#64;api.depends,
&#64;api.multi…</p>
<p>Els decoradors modifiquen la forma en la que és cridada la funció. Entre
altres coses, modifiquen el contingut de <strong>self</strong>, les vegades que se
crida i quant se crida.</p>
<ul class="simple">
<li><p><strong>&#64;api.depends()</strong> Aquest decorador crida a la funció sempre que el
camp del que depén siga modificat. Encara que el camp diga
<em>store=True</em>. Per defecte, <strong>self</strong> és un recordset, per tant, cal
fer un for.</p></li>
<li><p><strong>&#64;api.model</strong> S’utilitza per a funcions que afecten al model i no
als recordsets.</p></li>
<li><p><strong>&#64;api.constrains()</strong> S’utilitza per a comprovar les <em>constrains</em>.
Self és un recordset. Com que quasi sempre es crida en un form,
funciona si utilitzem self directament. Però cal fer for, ja que pot
ser cridat en un recordset quant modifiquem camps en grup.</p></li>
<li><p><strong>&#64;api.onchange()</strong> S’executa cada vegada que modifiquem el field
indicat en la vista. En aquest, com que es crida quant es modifica
un form, sempre <strong>self</strong> serà un singleton. Però si fiquem un for no
passa res.</p></li>
</ul>
</section>
<section id="calculs-en-dates">
<h3>Càlculs en dates<a class="headerlink" href="#calculs-en-dates" title="Link to this heading">#</a></h3>
<p>Odoo gestiona les dates com a strings. Per una altra banda, python té el
seu propi tipus de dades anomenat datetime, date i timedelta entre
altres. Això pot provocar dificultats per a fer cálculs en dates. Odoo
proporciona algunes ferramentes mínimes per facilitar aquesta tasca.</p>
<p>Primer de tot, anem a importar datetime:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</pre></div>
</div>
<p>El primer que necessitem saber és cóm transformar de date o datetime
d’Odoo a python. En definitva, passar de string a datetime.</p>
<p>Tenim un field datetime declarat de la següent manera:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="p">()</span>
</pre></div>
</div>
<p>En la base de dades guardarà un string amb el format: ‘%Y-%m-%d</p>
<p>objecte datetime.datetime tenim que ejecutar el constructor de la classe
amb aquests paràmetres:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span><span class="n">fmt</span><span class="p">)</span>
</pre></div>
</div>
<p>És a dir, transforma un string en aquest format al tipus de dades
datetime.datetime oficial de python.</p>
<p>Per no tindre que especificar el format cada vegada, Odoo dona una
ferramenta més facil. La classe <strong>fields.Datetime</strong> té un mètode per
generar un datetime.datetime de un string:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
</pre></div>
</div>
<p>De la mateixa manera passa al contrari:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
<span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
<span class="n">vs</span>
<span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>A continuació, anem a veure cóm incrementar una data en un temps:</strong></p>
<p>En el format d’Odoo (fields.Datetime) no es pot, cal passar a
datetime.datetime per sumar el temps i després tornar a passar a
fields.Datetime. Per sumar o restar temps a un datetime.datetime cal
utilitzar una classe anomenada datetime.timedelta. Aquesta classe
representa una duració o la diferència entre dues dates. Per exemple,
aquest constructor representa molt bé les opcions que es poden ficar per
crear un timedelta:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">un_any</span> <span class="o">=</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span> 
</pre></div>
</div>
<p>Aquest exemple d’Odoo mostra cóm afegir 3 dies a un field:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>O si es vol fer sols en mètodes python:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span><span class="n">fmt</span><span class="p">)</span>
<span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">+</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Ara anem a veure cóm calcular el temps que ha passat entre dues
dates:</strong></p>
<p>Solució amb <strong>relativedelta</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>

<span class="n">start</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
<span class="n">end</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>

<span class="n">relative</span><span class="o">=</span><span class="n">relativedelta</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">r</span><span class="o">.</span><span class="n">years</span>
<span class="nb">print</span> <span class="n">r</span><span class="o">.</span><span class="n">months</span>
<span class="nb">print</span> <span class="n">r</span><span class="o">.</span><span class="n">days</span>
<span class="nb">print</span> <span class="n">r</span>
</pre></div>
</div>
<p>El problema és que dona la data per separat. No sol ser molt útil per a
Odoo on necessitem la diferència sols en dies, hores o minuts.</p>
<p>Solució sols amb <strong>Datetime</strong>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
 
<span class="n">start</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span>
<span class="n">end</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_date</span><span class="p">)</span>
 
<span class="nb">print</span> <span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">24</span>
</pre></div>
</div>
<p>Solució amb <strong>Unix timestamp</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d1_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
<span class="n">d2_ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">d2</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>

<span class="nb">print</span> <span class="nb">int</span><span class="p">(</span><span class="n">d2_ts</span><span class="o">-</span><span class="n">d1_ts</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span>
</pre></div>
</div>
<p>La solució és la mateixa, sols és per si necessiteu algun càlcul
intermedi que necessite la data en un Integer.</p>
<p>El resultat de restar dos datetime és un timedelta. Podem demanar els
dies i segons com en el relative delta, però amés té una funció per
traure els segons totals i després fer els càlculs que necessitem.</p>
<p><strong>Consultar si una data és anterior a una altra:</strong></p>
<p>Les dates en format Datetime o Date es poden comparar:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d3</span><span class="o">=</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d3</span><span class="p">)</span>
<span class="n">d4</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="k">if</span> <span class="n">d3</span> <span class="o">&lt;</span> <span class="n">d4</span><span class="p">:</span>
   <span class="nb">print</span> <span class="s2">&quot;La data és anterior&quot;</span>
</pre></div>
</div>
<p>També es pot calcular si és del mateix dia, sols cal transformar de
datetime a date:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d3</span><span class="o">=</span><span class="n">d3</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="n">d4</span><span class="o">=</span><span class="n">d4</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

<span class="k">if</span> <span class="n">d3</span> <span class="o">==</span> <span class="n">d4</span> <span class="p">:</span>
   <span class="err">…</span><span class="o">.</span>
</pre></div>
</div>
<p>Si volem saber si són del mateix més o any, es pot calcular la
diferència i veure si en dies és major o menor de 30, per exemple. Però
si volem major precisió, en aquest cas es recomana utilitar
relativedelta.</p>
</section>
</section>
<section id="misc">
<h2>Misc.<a class="headerlink" href="#misc" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Si volem fer un print en colors, podem ficar un caracter de escape:
\033[93m i \033[0m al final</p></li>
<li><p>Traure la menor potència de 2 major o igual a un número:
<a class="reference external" href="http://stackoverflow.com/a/14267557">http://stackoverflow.com/a/14267557</a></p></li>
</ul>
<p>Distintes alertes:</p>
<p>Odoo pot mostrar distintes alertes en funció del que necessitem. Totes
estan en openerp.exceptions</p>
<p>Si entrem en el mode shell del debug podem executar aquest comandament:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; help(openerp.exceptions)
</pre></div>
</div>
<p>Una vegada dins podem detectar:</p>
<p><code class="docutils literal notranslate"><span class="pre">AccessDenied</span></code><br />
<code class="docutils literal notranslate"><span class="pre">DeferredException</span></code><br />
<code class="docutils literal notranslate"><span class="pre">QWebException</span></code><br />
<code class="docutils literal notranslate"><span class="pre">RedirectWarning</span></code><br />
<code class="docutils literal notranslate"><span class="pre">except_orm</span></code><br />
<code class="docutils literal notranslate"><span class="pre">        AccessError</span></code><br />
<code class="docutils literal notranslate"><span class="pre">        MissingError</span></code><br />
<code class="docutils literal notranslate"><span class="pre">        UserError</span></code><br />
<code class="docutils literal notranslate"><span class="pre">        ValidationError</span></code></p>
<p>Normalment són utilitzats pel Odoo sense necessitat de que els cridem
nosaltres. Però en ocasion pot ser útil.</p>
<p>Per exemple, si volem mostrar un Warning perquè úsuari ha fet alguna
cosa mal. (Normalment es fa un onchange que ja pot tornar el warning)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openerp</span> <span class="kn">import</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">openerp.exceptions</span> <span class="kn">import</span> <span class="ne">Warning</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Alguna cosa ha fallat!&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>O si volem Donar opcions a l’usuari amb RedirectWarning:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.action_res_users&#39;</span><span class="p">)</span>
 <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;You cannot create a new user from here.</span><span class="se">\n</span><span class="s2"> To create new user please go to configuration panel.&quot;</span><span class="p">)</span>
 <span class="k">raise</span> <span class="n">openerp</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RedirectWarning</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Go to the configuration panel&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>En aquest exemple, per al missatge, utilitza la barra baixa <strong>_()</strong> per
a obtindre la traducció en cas de que existisca. <strong>self.env.ref()</strong>
retorna l’objecte referit amb una id externa. En aquest cas, un action.</p>
<p>En el cas de les Constrains també s’ha de llançar un Validation error.</p>
<p>Funcions lambda:</p>
<p>En moltes ocasions, cal cridar a alguna funció de l’ORM o similar
passant com a paràmetre una funció lambda. La raó és que si passem una
variable, esta queda establerta en temps de càrrega i no es modifica. La
funció sempre recalcula.</p>
<p>La sintaxi de la funció lambda és:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span>
<span class="n">a</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="mi">6</span>
</pre></div>
</div>
<p>On les primeres x,y són els arguments que rep la funció, després el que
calcula.</p>
<p>Cal recordar que les funcions lambda són de una sola línia de codi. Si
volem alguna cosa més sofisticada hem de cridar a una funció normal.</p>
<p>Si volem que el nostre mòdul tinga configuració podem afegir-la com a un
field més del model <strong>res.control.settings</strong>. Aquest ja s’encarrega de
centralitzar opcions de configuració. Per a que aparega en el menú de
configuració també podem afegir-lo heretant en la vista:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">config</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TransientModel</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;res.config.settings&#39;</span>
    <span class="n">players</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;players&#39;</span><span class="p">,</span>
                             <span class="n">config_parameter</span><span class="o">=</span><span class="s2">&quot;expanse.players&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">reset_universe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;reset&quot;</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&lt;record</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;res_config_settings_view_form_inherit&quot;</span><span class="w"> </span><span class="na">model=</span><span class="s">&quot;ir.ui.view&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>res.config.settings.view.form.<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;model&quot;</span><span class="nt">&gt;</span>res.config.settings<span class="nt">&lt;/field&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;priority&quot;</span><span class="w"> </span><span class="na">eval=</span><span class="s">&quot;25&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;inherit_id&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;base.res_config_settings_view_form&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;arch&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;xpath</span><span class="w"> </span><span class="na">expr=</span><span class="s">&quot;//div[hasclass(&#39;settings&#39;)]&quot;</span><span class="w"> </span><span class="na">position=</span><span class="s">&quot;inside&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;app_settings_block&quot;</span><span class="w"> </span><span class="na">data-string=</span><span class="s">&quot;Expanse Settings&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;Expanse Settings&quot;</span><span class="w"> </span><span class="na">data-key=</span><span class="s">&quot;expanse&quot;</span><span class="nt">&gt;</span>
<span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;players&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;h2&gt;</span>Expanse<span class="nt">&lt;/h2&gt;</span>
<span class="w">                            </span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;object&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;reset_universe&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;Reset Universe&quot;</span><span class="w">  </span><span class="na">class=</span><span class="s">&quot;btn-primary&quot;</span><span class="nt">/&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/div&gt;</span>

<span class="w">                    </span><span class="nt">&lt;/div&gt;</span>
<span class="w">                </span><span class="nt">&lt;/xpath&gt;</span>

<span class="w">            </span><span class="nt">&lt;/field&gt;</span>
<span class="w">        </span><span class="nt">&lt;/record&gt;</span>
</pre></div>
</div>
<p>Si en data-key posem el nom del mòdul, afegirà l’icona al menú de
settings.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="instalarodoo.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Instal·lar Odoo</p>
      </div>
    </a>
    <a class="right-next"
       href="vista.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">La vista</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arquitectura">Arquitectura</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#la-base-de-dades-d-odoo">La base de dades d’Odoo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#els-moduls">Els mòduls</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#composicio-d-un-modul">Composició d’un mòdul</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estructura-de-fitxers-d-un-modul">Estructura de fitxers d’un mòdul</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creacio-de-moduls">Creació de mòduls</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#orm">ORM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inspeccionar-el-models">Inspeccionar el models</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fields">Fields</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fields-normals">Fields normals</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fields-relacionals">Fields Relacionals</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reference">Reference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#many2one">Many2one</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#one2many">One2many</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#many2many">Many2many</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#related">Related</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#many2onereference">Many2oneReference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#one2one">One2one</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#filtres-domains">Filtres (Domains)</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fields-computed">Fields Computed</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#buscar-i-escriure-en-camps-computed">Buscar i escriure en camps computed</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#valors-per-defecte">Valors per defecte</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#restriccions-constrains">Restriccions (constrains)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitxers-de-dades">Fitxers de dades</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#external-ids">External Ids</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expressions">Expressions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dades-per-als-binary-i-image">Dades per als Binary i Image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#esborrar">Esborrar</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#accions-i-menus">Accions i menús</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accions-tipus-window">Accions tipus <em>window</em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#la-vista">La vista</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#herencia">Herència</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#herencia-en-el-model">Herència en el Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#herencia-en-la-vista">Herència en la vista</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#herencia-en-el-controlador">Herència en el controlador</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#el-controlador">El controlador</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#api-de-l-orm">API de l’ORM</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-operations">Set operations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#programacio-funcional-en-l-orm">Programació funcional en l’ORM</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#enviroment">Enviroment</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#context">Context</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#metodes-de-l-orm">Mètodes de l’ORM</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#search">search()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#create">create()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#write">write()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#browse">browse()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#exists">exists()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#ref">ref()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#ensure-one">ensure_one()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#unlink">unlink()</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#onchange">onchange</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#cron-jobs">Cron Jobs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#els-decoradors">Els Decoradors</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculs-en-dates">Càlculs en dates</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#misc">Misc.</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jose Castillo
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>